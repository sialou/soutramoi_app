{"version":3,"file":"plugin.js","sources":["esm/index.js","esm/web.js"],"sourcesContent":["import { registerPlugin } from '@capacitor/core';\r\nconst FilePicker = registerPlugin('FilePicker', {\r\n    web: () => import('./web').then(m => new m.FilePickerWeb()),\r\n});\r\nexport * from './definitions';\r\nexport { FilePicker };\r\n//# sourceMappingURL=index.js.map","import { WebPlugin } from '@capacitor/core';\r\nexport class FilePickerWeb extends WebPlugin {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.ERROR_PICK_FILE_CANCELED = 'pickFiles canceled.';\r\n    }\r\n    async pickFiles(options) {\r\n        const pickedFiles = await this.openFilePicker(options);\r\n        if (!pickedFiles) {\r\n            throw new Error(this.ERROR_PICK_FILE_CANCELED);\r\n        }\r\n        const result = {\r\n            files: [],\r\n        };\r\n        for (const pickedFile of pickedFiles) {\r\n            const file = {\r\n                path: undefined,\r\n                name: this.getNameFromUrl(pickedFile),\r\n                mimeType: this.getMimeTypeFromUrl(pickedFile),\r\n                size: this.getSizeFromUrl(pickedFile),\r\n                blob: pickedFile,\r\n            };\r\n            if ((options === null || options === void 0 ? void 0 : options.readData) !== false) {\r\n                file.data = await this.getDataFromFile(pickedFile);\r\n            }\r\n            result.files.push(file);\r\n        }\r\n        return result;\r\n    }\r\n    async openFilePicker(options) {\r\n        var _a;\r\n        const accept = ((_a = options === null || options === void 0 ? void 0 : options.types) === null || _a === void 0 ? void 0 : _a.join(',')) || '';\r\n        const multiple = !!(options === null || options === void 0 ? void 0 : options.multiple);\r\n        return new Promise(resolve => {\r\n            let onChangeFired = false;\r\n            const input = document.createElement('input');\r\n            input.type = 'file';\r\n            input.accept = accept;\r\n            input.multiple = multiple;\r\n            input.addEventListener('change', () => {\r\n                onChangeFired = true;\r\n                const files = Array.from(input.files || []);\r\n                resolve(files);\r\n            }, { once: true });\r\n            // Workaround to detect when Cancel is selected in the File Selection dialog box.\r\n            window.addEventListener('focus', async () => {\r\n                await this.wait(1000);\r\n                if (onChangeFired) {\r\n                    return;\r\n                }\r\n                resolve(undefined);\r\n            }, { once: true });\r\n            input.click();\r\n        });\r\n    }\r\n    async getDataFromFile(file) {\r\n        return new Promise((resolve, reject) => {\r\n            const reader = new FileReader();\r\n            reader.readAsDataURL(file);\r\n            reader.onload = () => {\r\n                const result = typeof reader.result === 'string' ? reader.result : '';\r\n                const splittedResult = result.split('base64,');\r\n                const base64 = splittedResult[1] || '';\r\n                resolve(base64);\r\n            };\r\n            reader.onerror = error => {\r\n                reject(error);\r\n            };\r\n        });\r\n    }\r\n    getNameFromUrl(file) {\r\n        return file.name;\r\n    }\r\n    getMimeTypeFromUrl(file) {\r\n        return file.type;\r\n    }\r\n    getSizeFromUrl(file) {\r\n        return file.size;\r\n    }\r\n    async wait(delayMs) {\r\n        return new Promise(resolve => setTimeout(resolve, delayMs));\r\n    }\r\n}\r\n//# sourceMappingURL=web.js.map"],"names":["registerPlugin","WebPlugin"],"mappings":";;;AACK,UAAC,UAAU,GAAGA,mBAAc,CAAC,YAAY,EAAE;IAChD,IAAI,GAAG,EAAE,MAAM,mDAAe,CAAC,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,aAAa,EAAE,CAAC;IAC/D,CAAC;;ICFM,MAAM,aAAa,SAASC,cAAS,CAAC;IAC7C,IAAI,WAAW,GAAG;IAClB,QAAQ,KAAK,CAAC,GAAG,SAAS,CAAC,CAAC;IAC5B,QAAQ,IAAI,CAAC,wBAAwB,GAAG,qBAAqB,CAAC;IAC9D,KAAK;IACL,IAAI,MAAM,SAAS,CAAC,OAAO,EAAE;IAC7B,QAAQ,MAAM,WAAW,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;IAC/D,QAAQ,IAAI,CAAC,WAAW,EAAE;IAC1B,YAAY,MAAM,IAAI,KAAK,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;IAC3D,SAAS;IACT,QAAQ,MAAM,MAAM,GAAG;IACvB,YAAY,KAAK,EAAE,EAAE;IACrB,SAAS,CAAC;IACV,QAAQ,KAAK,MAAM,UAAU,IAAI,WAAW,EAAE;IAC9C,YAAY,MAAM,IAAI,GAAG;IACzB,gBAAgB,IAAI,EAAE,SAAS;IAC/B,gBAAgB,IAAI,EAAE,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC;IACrD,gBAAgB,QAAQ,EAAE,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAAC;IAC7D,gBAAgB,IAAI,EAAE,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC;IACrD,gBAAgB,IAAI,EAAE,UAAU;IAChC,aAAa,CAAC;IACd,YAAY,IAAI,CAAC,OAAO,KAAK,IAAI,IAAI,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAG,OAAO,CAAC,QAAQ,MAAM,KAAK,EAAE;IAChG,gBAAgB,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC;IACnE,aAAa;IACb,YAAY,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACpC,SAAS;IACT,QAAQ,OAAO,MAAM,CAAC;IACtB,KAAK;IACL,IAAI,MAAM,cAAc,CAAC,OAAO,EAAE;IAClC,QAAQ,IAAI,EAAE,CAAC;IACf,QAAQ,MAAM,MAAM,GAAG,CAAC,CAAC,EAAE,GAAG,OAAO,KAAK,IAAI,IAAI,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAG,OAAO,CAAC,KAAK,MAAM,IAAI,IAAI,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC;IACxJ,QAAQ,MAAM,QAAQ,GAAG,CAAC,EAAE,OAAO,KAAK,IAAI,IAAI,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;IAChG,QAAQ,OAAO,IAAI,OAAO,CAAC,OAAO,IAAI;IACtC,YAAY,IAAI,aAAa,GAAG,KAAK,CAAC;IACtC,YAAY,MAAM,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;IAC1D,YAAY,KAAK,CAAC,IAAI,GAAG,MAAM,CAAC;IAChC,YAAY,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;IAClC,YAAY,KAAK,CAAC,QAAQ,GAAG,QAAQ,CAAC;IACtC,YAAY,KAAK,CAAC,gBAAgB,CAAC,QAAQ,EAAE,MAAM;IACnD,gBAAgB,aAAa,GAAG,IAAI,CAAC;IACrC,gBAAgB,MAAM,KAAK,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,IAAI,EAAE,CAAC,CAAC;IAC5D,gBAAgB,OAAO,CAAC,KAAK,CAAC,CAAC;IAC/B,aAAa,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;IAC/B;IACA,YAAY,MAAM,CAAC,gBAAgB,CAAC,OAAO,EAAE,YAAY;IACzD,gBAAgB,MAAM,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACtC,gBAAgB,IAAI,aAAa,EAAE;IACnC,oBAAoB,OAAO;IAC3B,iBAAiB;IACjB,gBAAgB,OAAO,CAAC,SAAS,CAAC,CAAC;IACnC,aAAa,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;IAC/B,YAAY,KAAK,CAAC,KAAK,EAAE,CAAC;IAC1B,SAAS,CAAC,CAAC;IACX,KAAK;IACL,IAAI,MAAM,eAAe,CAAC,IAAI,EAAE;IAChC,QAAQ,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK;IAChD,YAAY,MAAM,MAAM,GAAG,IAAI,UAAU,EAAE,CAAC;IAC5C,YAAY,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;IACvC,YAAY,MAAM,CAAC,MAAM,GAAG,MAAM;IAClC,gBAAgB,MAAM,MAAM,GAAG,OAAO,MAAM,CAAC,MAAM,KAAK,QAAQ,GAAG,MAAM,CAAC,MAAM,GAAG,EAAE,CAAC;IACtF,gBAAgB,MAAM,cAAc,GAAG,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;IAC/D,gBAAgB,MAAM,MAAM,GAAG,cAAc,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;IACvD,gBAAgB,OAAO,CAAC,MAAM,CAAC,CAAC;IAChC,aAAa,CAAC;IACd,YAAY,MAAM,CAAC,OAAO,GAAG,KAAK,IAAI;IACtC,gBAAgB,MAAM,CAAC,KAAK,CAAC,CAAC;IAC9B,aAAa,CAAC;IACd,SAAS,CAAC,CAAC;IACX,KAAK;IACL,IAAI,cAAc,CAAC,IAAI,EAAE;IACzB,QAAQ,OAAO,IAAI,CAAC,IAAI,CAAC;IACzB,KAAK;IACL,IAAI,kBAAkB,CAAC,IAAI,EAAE;IAC7B,QAAQ,OAAO,IAAI,CAAC,IAAI,CAAC;IACzB,KAAK;IACL,IAAI,cAAc,CAAC,IAAI,EAAE;IACzB,QAAQ,OAAO,IAAI,CAAC,IAAI,CAAC;IACzB,KAAK;IACL,IAAI,MAAM,IAAI,CAAC,OAAO,EAAE;IACxB,QAAQ,OAAO,IAAI,OAAO,CAAC,OAAO,IAAI,UAAU,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC,CAAC;IACpE,KAAK;IACL;;;;;;;;;;;;;;;;;"}