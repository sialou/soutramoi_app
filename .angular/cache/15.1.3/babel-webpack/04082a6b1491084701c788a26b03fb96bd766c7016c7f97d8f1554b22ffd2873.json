{"ast":null,"code":"/*************************\r\n * Croppie\r\n * Copyright 2019\r\n * Foliotek\r\n * Version: 2.6.5\r\n *************************/\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define(factory);\n  } else if (typeof exports === 'object' && typeof exports.nodeName !== 'string') {\n    // CommonJS\n    module.exports = factory();\n  } else {\n    // Browser globals\n    root.Croppie = factory();\n  }\n})(typeof self !== 'undefined' ? self : this, function () {\n  /* Polyfills */\n  if (typeof Promise !== 'function') {\n    /*! promise-polyfill 3.1.0 */\n    !function (a) {\n      function b(a, b) {\n        return function () {\n          a.apply(b, arguments);\n        };\n      }\n      function c(a) {\n        if (\"object\" !== typeof this) throw new TypeError(\"Promises must be constructed via new\");\n        if (\"function\" !== typeof a) throw new TypeError(\"not a function\");\n        this._state = null, this._value = null, this._deferreds = [], i(a, b(e, this), b(f, this));\n      }\n      function d(a) {\n        var b = this;\n        return null === this._state ? void this._deferreds.push(a) : void k(function () {\n          var c = b._state ? a.onFulfilled : a.onRejected;\n          if (null === c) return void (b._state ? a.resolve : a.reject)(b._value);\n          var d;\n          try {\n            d = c(b._value);\n          } catch (e) {\n            return void a.reject(e);\n          }\n          a.resolve(d);\n        });\n      }\n      function e(a) {\n        try {\n          if (a === this) throw new TypeError(\"A promise cannot be resolved with itself.\");\n          if (a && (\"object\" === typeof a || \"function\" === typeof a)) {\n            var c = a.then;\n            if (\"function\" === typeof c) return void i(b(c, a), b(e, this), b(f, this));\n          }\n          this._state = !0, this._value = a, g.call(this);\n        } catch (d) {\n          f.call(this, d);\n        }\n      }\n      function f(a) {\n        this._state = !1, this._value = a, g.call(this);\n      }\n      function g() {\n        for (var a = 0, b = this._deferreds.length; b > a; a++) d.call(this, this._deferreds[a]);\n        this._deferreds = null;\n      }\n      function h(a, b, c, d) {\n        this.onFulfilled = \"function\" === typeof a ? a : null, this.onRejected = \"function\" === typeof b ? b : null, this.resolve = c, this.reject = d;\n      }\n      function i(a, b, c) {\n        var d = !1;\n        try {\n          a(function (a) {\n            d || (d = !0, b(a));\n          }, function (a) {\n            d || (d = !0, c(a));\n          });\n        } catch (e) {\n          if (d) return;\n          d = !0, c(e);\n        }\n      }\n      var j = setTimeout,\n        k = \"function\" === typeof setImmediate && setImmediate || function (a) {\n          j(a, 1);\n        },\n        l = Array.isArray || function (a) {\n          return \"[object Array]\" === Object.prototype.toString.call(a);\n        };\n      c.prototype[\"catch\"] = function (a) {\n        return this.then(null, a);\n      }, c.prototype.then = function (a, b) {\n        var e = this;\n        return new c(function (c, f) {\n          d.call(e, new h(a, b, c, f));\n        });\n      }, c.all = function () {\n        var a = Array.prototype.slice.call(1 === arguments.length && l(arguments[0]) ? arguments[0] : arguments);\n        return new c(function (b, c) {\n          function d(f, g) {\n            try {\n              if (g && (\"object\" === typeof g || \"function\" === typeof g)) {\n                var h = g.then;\n                if (\"function\" === typeof h) return void h.call(g, function (a) {\n                  d(f, a);\n                }, c);\n              }\n              a[f] = g, 0 === --e && b(a);\n            } catch (i) {\n              c(i);\n            }\n          }\n          if (0 === a.length) return b([]);\n          for (var e = a.length, f = 0; f < a.length; f++) d(f, a[f]);\n        });\n      }, c.resolve = function (a) {\n        return a && \"object\" === typeof a && a.constructor === c ? a : new c(function (b) {\n          b(a);\n        });\n      }, c.reject = function (a) {\n        return new c(function (b, c) {\n          c(a);\n        });\n      }, c.race = function (a) {\n        return new c(function (b, c) {\n          for (var d = 0, e = a.length; e > d; d++) a[d].then(b, c);\n        });\n      }, c._setImmediateFn = function (a) {\n        k = a;\n      }, \"undefined\" !== typeof module && module.exports ? module.exports = c : a.Promise || (a.Promise = c);\n    }(this);\n  }\n  if (typeof window !== 'undefined' && typeof window.CustomEvent !== \"function\") {\n    (function () {\n      function CustomEvent(event, params) {\n        params = params || {\n          bubbles: false,\n          cancelable: false,\n          detail: undefined\n        };\n        var evt = document.createEvent('CustomEvent');\n        evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n        return evt;\n      }\n      CustomEvent.prototype = window.Event.prototype;\n      window.CustomEvent = CustomEvent;\n    })();\n  }\n  if (typeof HTMLCanvasElement !== 'undefined' && !HTMLCanvasElement.prototype.toBlob) {\n    Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\n      value: function (callback, type, quality) {\n        var binStr = atob(this.toDataURL(type, quality).split(',')[1]),\n          len = binStr.length,\n          arr = new Uint8Array(len);\n        for (var i = 0; i < len; i++) {\n          arr[i] = binStr.charCodeAt(i);\n        }\n        callback(new Blob([arr], {\n          type: type || 'image/png'\n        }));\n      }\n    });\n  }\n  /* End Polyfills */\n\n  var cssPrefixes = ['Webkit', 'Moz', 'ms'],\n    emptyStyles = typeof document !== 'undefined' ? document.createElement('div').style : {},\n    EXIF_NORM = [1, 8, 3, 6],\n    EXIF_FLIP = [2, 7, 4, 5],\n    CSS_TRANS_ORG,\n    CSS_TRANSFORM,\n    CSS_USERSELECT;\n  function vendorPrefix(prop) {\n    if (prop in emptyStyles) {\n      return prop;\n    }\n    var capProp = prop[0].toUpperCase() + prop.slice(1),\n      i = cssPrefixes.length;\n    while (i--) {\n      prop = cssPrefixes[i] + capProp;\n      if (prop in emptyStyles) {\n        return prop;\n      }\n    }\n  }\n  CSS_TRANSFORM = vendorPrefix('transform');\n  CSS_TRANS_ORG = vendorPrefix('transformOrigin');\n  CSS_USERSELECT = vendorPrefix('userSelect');\n  function getExifOffset(ornt, rotate) {\n    var arr = EXIF_NORM.indexOf(ornt) > -1 ? EXIF_NORM : EXIF_FLIP,\n      index = arr.indexOf(ornt),\n      offset = rotate / 90 % arr.length; // 180 = 2%4 = 2 shift exif by 2 indexes\n\n    return arr[(arr.length + index + offset % arr.length) % arr.length];\n  }\n\n  // Credits to : Andrew Dupont - http://andrewdupont.net/2009/08/28/deep-extending-objects-in-javascript/\n  function deepExtend(destination, source) {\n    destination = destination || {};\n    for (var property in source) {\n      if (source[property] && source[property].constructor && source[property].constructor === Object) {\n        destination[property] = destination[property] || {};\n        deepExtend(destination[property], source[property]);\n      } else {\n        destination[property] = source[property];\n      }\n    }\n    return destination;\n  }\n  function clone(object) {\n    return deepExtend({}, object);\n  }\n  function debounce(func, wait, immediate) {\n    var timeout;\n    return function () {\n      var context = this,\n        args = arguments;\n      var later = function () {\n        timeout = null;\n        if (!immediate) func.apply(context, args);\n      };\n      var callNow = immediate && !timeout;\n      clearTimeout(timeout);\n      timeout = setTimeout(later, wait);\n      if (callNow) func.apply(context, args);\n    };\n  }\n  function dispatchChange(element) {\n    if (\"createEvent\" in document) {\n      var evt = document.createEvent(\"HTMLEvents\");\n      evt.initEvent(\"change\", false, true);\n      element.dispatchEvent(evt);\n    } else {\n      element.fireEvent(\"onchange\");\n    }\n  }\n\n  //http://jsperf.com/vanilla-css\n  function css(el, styles, val) {\n    if (typeof styles === 'string') {\n      var tmp = styles;\n      styles = {};\n      styles[tmp] = val;\n    }\n    for (var prop in styles) {\n      el.style[prop] = styles[prop];\n    }\n  }\n  function addClass(el, c) {\n    if (el.classList) {\n      el.classList.add(c);\n    } else {\n      el.className += ' ' + c;\n    }\n  }\n  function removeClass(el, c) {\n    if (el.classList) {\n      el.classList.remove(c);\n    } else {\n      el.className = el.className.replace(c, '');\n    }\n  }\n  function setAttributes(el, attrs) {\n    for (var key in attrs) {\n      el.setAttribute(key, attrs[key]);\n    }\n  }\n  function num(v) {\n    return parseInt(v, 10);\n  }\n\n  /* Utilities */\n  function loadImage(src, doExif) {\n    if (!src) {\n      throw 'Source image missing';\n    }\n    var img = new Image();\n    img.style.opacity = '0';\n    return new Promise(function (resolve, reject) {\n      function _resolve() {\n        img.style.opacity = '1';\n        setTimeout(function () {\n          resolve(img);\n        }, 1);\n      }\n      img.removeAttribute('crossOrigin');\n      if (src.match(/^https?:\\/\\/|^\\/\\//)) {\n        img.setAttribute('crossOrigin', 'anonymous');\n      }\n      img.onload = function () {\n        if (doExif) {\n          EXIF.getData(img, function () {\n            _resolve();\n          });\n        } else {\n          _resolve();\n        }\n      };\n      img.onerror = function (ev) {\n        img.style.opacity = 1;\n        setTimeout(function () {\n          reject(ev);\n        }, 1);\n      };\n      img.src = src;\n    });\n  }\n  function naturalImageDimensions(img, ornt) {\n    var w = img.naturalWidth;\n    var h = img.naturalHeight;\n    var orient = ornt || getExifOrientation(img);\n    if (orient && orient >= 5) {\n      var x = w;\n      w = h;\n      h = x;\n    }\n    return {\n      width: w,\n      height: h\n    };\n  }\n\n  /* CSS Transform Prototype */\n  var TRANSLATE_OPTS = {\n    'translate3d': {\n      suffix: ', 0px'\n    },\n    'translate': {\n      suffix: ''\n    }\n  };\n  var Transform = function (x, y, scale) {\n    this.x = parseFloat(x);\n    this.y = parseFloat(y);\n    this.scale = parseFloat(scale);\n  };\n  Transform.parse = function (v) {\n    if (v.style) {\n      return Transform.parse(v.style[CSS_TRANSFORM]);\n    } else if (v.indexOf('matrix') > -1 || v.indexOf('none') > -1) {\n      return Transform.fromMatrix(v);\n    } else {\n      return Transform.fromString(v);\n    }\n  };\n  Transform.fromMatrix = function (v) {\n    var vals = v.substring(7).split(',');\n    if (!vals.length || v === 'none') {\n      vals = [1, 0, 0, 1, 0, 0];\n    }\n    return new Transform(num(vals[4]), num(vals[5]), parseFloat(vals[0]));\n  };\n  Transform.fromString = function (v) {\n    var values = v.split(') '),\n      translate = values[0].substring(Croppie.globals.translate.length + 1).split(','),\n      scale = values.length > 1 ? values[1].substring(6) : 1,\n      x = translate.length > 1 ? translate[0] : 0,\n      y = translate.length > 1 ? translate[1] : 0;\n    return new Transform(x, y, scale);\n  };\n  Transform.prototype.toString = function () {\n    var suffix = TRANSLATE_OPTS[Croppie.globals.translate].suffix || '';\n    return Croppie.globals.translate + '(' + this.x + 'px, ' + this.y + 'px' + suffix + ') scale(' + this.scale + ')';\n  };\n  var TransformOrigin = function (el) {\n    if (!el || !el.style[CSS_TRANS_ORG]) {\n      this.x = 0;\n      this.y = 0;\n      return;\n    }\n    var css = el.style[CSS_TRANS_ORG].split(' ');\n    this.x = parseFloat(css[0]);\n    this.y = parseFloat(css[1]);\n  };\n  TransformOrigin.prototype.toString = function () {\n    return this.x + 'px ' + this.y + 'px';\n  };\n  function getExifOrientation(img) {\n    return img.exifdata && img.exifdata.Orientation ? num(img.exifdata.Orientation) : 1;\n  }\n  function drawCanvas(canvas, img, orientation) {\n    var width = img.width,\n      height = img.height,\n      ctx = canvas.getContext('2d');\n    canvas.width = img.width;\n    canvas.height = img.height;\n    ctx.save();\n    switch (orientation) {\n      case 2:\n        ctx.translate(width, 0);\n        ctx.scale(-1, 1);\n        break;\n      case 3:\n        ctx.translate(width, height);\n        ctx.rotate(180 * Math.PI / 180);\n        break;\n      case 4:\n        ctx.translate(0, height);\n        ctx.scale(1, -1);\n        break;\n      case 5:\n        canvas.width = height;\n        canvas.height = width;\n        ctx.rotate(90 * Math.PI / 180);\n        ctx.scale(1, -1);\n        break;\n      case 6:\n        canvas.width = height;\n        canvas.height = width;\n        ctx.rotate(90 * Math.PI / 180);\n        ctx.translate(0, -height);\n        break;\n      case 7:\n        canvas.width = height;\n        canvas.height = width;\n        ctx.rotate(-90 * Math.PI / 180);\n        ctx.translate(-width, height);\n        ctx.scale(1, -1);\n        break;\n      case 8:\n        canvas.width = height;\n        canvas.height = width;\n        ctx.translate(0, width);\n        ctx.rotate(-90 * Math.PI / 180);\n        break;\n    }\n    ctx.drawImage(img, 0, 0, width, height);\n    ctx.restore();\n  }\n\n  /* Private Methods */\n  function _create() {\n    var self = this,\n      contClass = 'croppie-container',\n      customViewportClass = self.options.viewport.type ? 'cr-vp-' + self.options.viewport.type : null,\n      boundary,\n      img,\n      viewport,\n      overlay,\n      bw,\n      bh;\n    self.options.useCanvas = self.options.enableOrientation || _hasExif.call(self);\n    // Properties on class\n    self.data = {};\n    self.elements = {};\n    boundary = self.elements.boundary = document.createElement('div');\n    viewport = self.elements.viewport = document.createElement('div');\n    img = self.elements.img = document.createElement('img');\n    overlay = self.elements.overlay = document.createElement('div');\n    if (self.options.useCanvas) {\n      self.elements.canvas = document.createElement('canvas');\n      self.elements.preview = self.elements.canvas;\n    } else {\n      self.elements.preview = img;\n    }\n    addClass(boundary, 'cr-boundary');\n    boundary.setAttribute('aria-dropeffect', 'none');\n    bw = self.options.boundary.width;\n    bh = self.options.boundary.height;\n    css(boundary, {\n      width: bw + (isNaN(bw) ? '' : 'px'),\n      height: bh + (isNaN(bh) ? '' : 'px')\n    });\n    addClass(viewport, 'cr-viewport');\n    if (customViewportClass) {\n      addClass(viewport, customViewportClass);\n    }\n    css(viewport, {\n      width: self.options.viewport.width + 'px',\n      height: self.options.viewport.height + 'px'\n    });\n    viewport.setAttribute('tabindex', 0);\n    addClass(self.elements.preview, 'cr-image');\n    setAttributes(self.elements.preview, {\n      'alt': 'preview',\n      'aria-grabbed': 'false'\n    });\n    addClass(overlay, 'cr-overlay');\n    self.element.appendChild(boundary);\n    boundary.appendChild(self.elements.preview);\n    boundary.appendChild(viewport);\n    boundary.appendChild(overlay);\n    addClass(self.element, contClass);\n    if (self.options.customClass) {\n      addClass(self.element, self.options.customClass);\n    }\n    _initDraggable.call(this);\n    if (self.options.enableZoom) {\n      _initializeZoom.call(self);\n    }\n\n    // if (self.options.enableOrientation) {\n    //     _initRotationControls.call(self);\n    // }\n\n    if (self.options.enableResize) {\n      _initializeResize.call(self);\n    }\n  }\n\n  // function _initRotationControls () {\n  //     var self = this,\n  //         wrap, btnLeft, btnRight, iLeft, iRight;\n\n  //     wrap = document.createElement('div');\n  //     self.elements.orientationBtnLeft = btnLeft = document.createElement('button');\n  //     self.elements.orientationBtnRight = btnRight = document.createElement('button');\n\n  //     wrap.appendChild(btnLeft);\n  //     wrap.appendChild(btnRight);\n\n  //     iLeft = document.createElement('i');\n  //     iRight = document.createElement('i');\n  //     btnLeft.appendChild(iLeft);\n  //     btnRight.appendChild(iRight);\n\n  //     addClass(wrap, 'cr-rotate-controls');\n  //     addClass(btnLeft, 'cr-rotate-l');\n  //     addClass(btnRight, 'cr-rotate-r');\n\n  //     self.elements.boundary.appendChild(wrap);\n\n  //     btnLeft.addEventListener('click', function () {\n  //         self.rotate(-90);\n  //     });\n  //     btnRight.addEventListener('click', function () {\n  //         self.rotate(90);\n  //     });\n  // }\n\n  function _hasExif() {\n    return this.options.enableExif && window.EXIF;\n  }\n  function _initializeResize() {\n    var self = this;\n    var wrap = document.createElement('div');\n    var isDragging = false;\n    var direction;\n    var originalX;\n    var originalY;\n    var minSize = 50;\n    var maxWidth;\n    var maxHeight;\n    var vr;\n    var hr;\n    addClass(wrap, 'cr-resizer');\n    css(wrap, {\n      width: this.options.viewport.width + 'px',\n      height: this.options.viewport.height + 'px'\n    });\n    if (this.options.resizeControls.height) {\n      vr = document.createElement('div');\n      addClass(vr, 'cr-resizer-vertical');\n      wrap.appendChild(vr);\n    }\n    if (this.options.resizeControls.width) {\n      hr = document.createElement('div');\n      addClass(hr, 'cr-resizer-horisontal');\n      wrap.appendChild(hr);\n    }\n    function mouseDown(ev) {\n      if (ev.button !== undefined && ev.button !== 0) return;\n      ev.preventDefault();\n      if (isDragging) {\n        return;\n      }\n      var overlayRect = self.elements.overlay.getBoundingClientRect();\n      isDragging = true;\n      originalX = ev.pageX;\n      originalY = ev.pageY;\n      direction = ev.currentTarget.className.indexOf('vertical') !== -1 ? 'v' : 'h';\n      maxWidth = overlayRect.width;\n      maxHeight = overlayRect.height;\n      if (ev.touches) {\n        var touches = ev.touches[0];\n        originalX = touches.pageX;\n        originalY = touches.pageY;\n      }\n      window.addEventListener('mousemove', mouseMove);\n      window.addEventListener('touchmove', mouseMove);\n      window.addEventListener('mouseup', mouseUp);\n      window.addEventListener('touchend', mouseUp);\n      document.body.style[CSS_USERSELECT] = 'none';\n    }\n    function mouseMove(ev) {\n      var pageX = ev.pageX;\n      var pageY = ev.pageY;\n      ev.preventDefault();\n      if (ev.touches) {\n        var touches = ev.touches[0];\n        pageX = touches.pageX;\n        pageY = touches.pageY;\n      }\n      var deltaX = pageX - originalX;\n      var deltaY = pageY - originalY;\n      var newHeight = self.options.viewport.height + deltaY;\n      var newWidth = self.options.viewport.width + deltaX;\n      if (direction === 'v' && newHeight >= minSize && newHeight <= maxHeight) {\n        css(wrap, {\n          height: newHeight + 'px'\n        });\n        self.options.boundary.height += deltaY;\n        css(self.elements.boundary, {\n          height: self.options.boundary.height + 'px'\n        });\n        self.options.viewport.height += deltaY;\n        css(self.elements.viewport, {\n          height: self.options.viewport.height + 'px'\n        });\n      } else if (direction === 'h' && newWidth >= minSize && newWidth <= maxWidth) {\n        css(wrap, {\n          width: newWidth + 'px'\n        });\n        self.options.boundary.width += deltaX;\n        css(self.elements.boundary, {\n          width: self.options.boundary.width + 'px'\n        });\n        self.options.viewport.width += deltaX;\n        css(self.elements.viewport, {\n          width: self.options.viewport.width + 'px'\n        });\n      }\n      _updateOverlay.call(self);\n      _updateZoomLimits.call(self);\n      _updateCenterPoint.call(self);\n      _triggerUpdate.call(self);\n      originalY = pageY;\n      originalX = pageX;\n    }\n    function mouseUp() {\n      isDragging = false;\n      window.removeEventListener('mousemove', mouseMove);\n      window.removeEventListener('touchmove', mouseMove);\n      window.removeEventListener('mouseup', mouseUp);\n      window.removeEventListener('touchend', mouseUp);\n      document.body.style[CSS_USERSELECT] = '';\n    }\n    if (vr) {\n      vr.addEventListener('mousedown', mouseDown);\n      vr.addEventListener('touchstart', mouseDown);\n    }\n    if (hr) {\n      hr.addEventListener('mousedown', mouseDown);\n      hr.addEventListener('touchstart', mouseDown);\n    }\n    this.elements.boundary.appendChild(wrap);\n  }\n  function _setZoomerVal(v) {\n    if (this.options.enableZoom) {\n      var z = this.elements.zoomer,\n        val = fix(v, 4);\n      z.value = Math.max(parseFloat(z.min), Math.min(parseFloat(z.max), val)).toString();\n    }\n  }\n  function _initializeZoom() {\n    var self = this,\n      wrap = self.elements.zoomerWrap = document.createElement('div'),\n      zoomer = self.elements.zoomer = document.createElement('input');\n    addClass(wrap, 'cr-slider-wrap');\n    addClass(zoomer, 'cr-slider');\n    zoomer.type = 'range';\n    zoomer.step = '0.0001';\n    zoomer.value = '1';\n    zoomer.style.display = self.options.showZoomer ? '' : 'none';\n    zoomer.setAttribute('aria-label', 'zoom');\n    self.element.appendChild(wrap);\n    wrap.appendChild(zoomer);\n    self._currentZoom = 1;\n    function change() {\n      _onZoom.call(self, {\n        value: parseFloat(zoomer.value),\n        origin: new TransformOrigin(self.elements.preview),\n        viewportRect: self.elements.viewport.getBoundingClientRect(),\n        transform: Transform.parse(self.elements.preview)\n      });\n    }\n    function scroll(ev) {\n      var delta, targetZoom;\n      if (self.options.mouseWheelZoom === 'ctrl' && ev.ctrlKey !== true) {\n        return 0;\n      } else if (ev.wheelDelta) {\n        delta = ev.wheelDelta / 1200; //wheelDelta min: -120 max: 120 // max x 10 x 2\n      } else if (ev.deltaY) {\n        delta = ev.deltaY / 1060; //deltaY min: -53 max: 53 // max x 10 x 2\n      } else if (ev.detail) {\n        delta = ev.detail / -60; //delta min: -3 max: 3 // max x 10 x 2\n      } else {\n        delta = 0;\n      }\n      targetZoom = self._currentZoom + delta * self._currentZoom;\n      ev.preventDefault();\n      _setZoomerVal.call(self, targetZoom);\n      change.call(self);\n    }\n    self.elements.zoomer.addEventListener('input', change); // this is being fired twice on keypress\n    self.elements.zoomer.addEventListener('change', change);\n    if (self.options.mouseWheelZoom) {\n      self.elements.boundary.addEventListener('mousewheel', scroll);\n      self.elements.boundary.addEventListener('DOMMouseScroll', scroll);\n    }\n  }\n  function _onZoom(ui) {\n    var self = this,\n      transform = ui ? ui.transform : Transform.parse(self.elements.preview),\n      vpRect = ui ? ui.viewportRect : self.elements.viewport.getBoundingClientRect(),\n      origin = ui ? ui.origin : new TransformOrigin(self.elements.preview);\n    function applyCss() {\n      var transCss = {};\n      transCss[CSS_TRANSFORM] = transform.toString();\n      transCss[CSS_TRANS_ORG] = origin.toString();\n      css(self.elements.preview, transCss);\n    }\n    self._currentZoom = ui ? ui.value : self._currentZoom;\n    transform.scale = self._currentZoom;\n    self.elements.zoomer.setAttribute('aria-valuenow', self._currentZoom);\n    applyCss();\n    if (self.options.enforceBoundary) {\n      var boundaries = _getVirtualBoundaries.call(self, vpRect),\n        transBoundaries = boundaries.translate,\n        oBoundaries = boundaries.origin;\n      if (transform.x >= transBoundaries.maxX) {\n        origin.x = oBoundaries.minX;\n        transform.x = transBoundaries.maxX;\n      }\n      if (transform.x <= transBoundaries.minX) {\n        origin.x = oBoundaries.maxX;\n        transform.x = transBoundaries.minX;\n      }\n      if (transform.y >= transBoundaries.maxY) {\n        origin.y = oBoundaries.minY;\n        transform.y = transBoundaries.maxY;\n      }\n      if (transform.y <= transBoundaries.minY) {\n        origin.y = oBoundaries.maxY;\n        transform.y = transBoundaries.minY;\n      }\n    }\n    applyCss();\n    _debouncedOverlay.call(self);\n    _triggerUpdate.call(self);\n  }\n  function _getVirtualBoundaries(viewport) {\n    var self = this,\n      scale = self._currentZoom,\n      vpWidth = viewport.width,\n      vpHeight = viewport.height,\n      centerFromBoundaryX = self.elements.boundary.clientWidth / 2,\n      centerFromBoundaryY = self.elements.boundary.clientHeight / 2,\n      imgRect = self.elements.preview.getBoundingClientRect(),\n      curImgWidth = imgRect.width,\n      curImgHeight = imgRect.height,\n      halfWidth = vpWidth / 2,\n      halfHeight = vpHeight / 2;\n    var maxX = (halfWidth / scale - centerFromBoundaryX) * -1;\n    var minX = maxX - (curImgWidth * (1 / scale) - vpWidth * (1 / scale));\n    var maxY = (halfHeight / scale - centerFromBoundaryY) * -1;\n    var minY = maxY - (curImgHeight * (1 / scale) - vpHeight * (1 / scale));\n    var originMinX = 1 / scale * halfWidth;\n    var originMaxX = curImgWidth * (1 / scale) - originMinX;\n    var originMinY = 1 / scale * halfHeight;\n    var originMaxY = curImgHeight * (1 / scale) - originMinY;\n    return {\n      translate: {\n        maxX: maxX,\n        minX: minX,\n        maxY: maxY,\n        minY: minY\n      },\n      origin: {\n        maxX: originMaxX,\n        minX: originMinX,\n        maxY: originMaxY,\n        minY: originMinY\n      }\n    };\n  }\n  function _updateCenterPoint(rotate) {\n    var self = this,\n      scale = self._currentZoom,\n      data = self.elements.preview.getBoundingClientRect(),\n      vpData = self.elements.viewport.getBoundingClientRect(),\n      transform = Transform.parse(self.elements.preview.style[CSS_TRANSFORM]),\n      pc = new TransformOrigin(self.elements.preview),\n      top = vpData.top - data.top + vpData.height / 2,\n      left = vpData.left - data.left + vpData.width / 2,\n      center = {},\n      adj = {};\n    if (rotate) {\n      var cx = pc.x;\n      var cy = pc.y;\n      var tx = transform.x;\n      var ty = transform.y;\n      center.y = cx;\n      center.x = cy;\n      transform.y = tx;\n      transform.x = ty;\n    } else {\n      center.y = top / scale;\n      center.x = left / scale;\n      adj.y = (center.y - pc.y) * (1 - scale);\n      adj.x = (center.x - pc.x) * (1 - scale);\n      transform.x -= adj.x;\n      transform.y -= adj.y;\n    }\n    var newCss = {};\n    newCss[CSS_TRANS_ORG] = center.x + 'px ' + center.y + 'px';\n    newCss[CSS_TRANSFORM] = transform.toString();\n    css(self.elements.preview, newCss);\n  }\n  function _initDraggable() {\n    var self = this,\n      isDragging = false,\n      originalX,\n      originalY,\n      originalDistance,\n      vpRect,\n      transform;\n    function assignTransformCoordinates(deltaX, deltaY) {\n      var imgRect = self.elements.preview.getBoundingClientRect(),\n        top = transform.y + deltaY,\n        left = transform.x + deltaX;\n      if (self.options.enforceBoundary) {\n        if (vpRect.top > imgRect.top + deltaY && vpRect.bottom < imgRect.bottom + deltaY) {\n          transform.y = top;\n        }\n        if (vpRect.left > imgRect.left + deltaX && vpRect.right < imgRect.right + deltaX) {\n          transform.x = left;\n        }\n      } else {\n        transform.y = top;\n        transform.x = left;\n      }\n    }\n    function toggleGrabState(isDragging) {\n      self.elements.preview.setAttribute('aria-grabbed', isDragging);\n      self.elements.boundary.setAttribute('aria-dropeffect', isDragging ? 'move' : 'none');\n    }\n    function keyDown(ev) {\n      var LEFT_ARROW = 37,\n        UP_ARROW = 38,\n        RIGHT_ARROW = 39,\n        DOWN_ARROW = 40;\n      if (ev.shiftKey && (ev.keyCode === UP_ARROW || ev.keyCode === DOWN_ARROW)) {\n        var zoom;\n        if (ev.keyCode === UP_ARROW) {\n          zoom = parseFloat(self.elements.zoomer.value) + parseFloat(self.elements.zoomer.step);\n        } else {\n          zoom = parseFloat(self.elements.zoomer.value) - parseFloat(self.elements.zoomer.step);\n        }\n        self.setZoom(zoom);\n      } else if (self.options.enableKeyMovement && ev.keyCode >= 37 && ev.keyCode <= 40) {\n        ev.preventDefault();\n        var movement = parseKeyDown(ev.keyCode);\n        transform = Transform.parse(self.elements.preview);\n        document.body.style[CSS_USERSELECT] = 'none';\n        vpRect = self.elements.viewport.getBoundingClientRect();\n        keyMove(movement);\n      }\n      function parseKeyDown(key) {\n        switch (key) {\n          case LEFT_ARROW:\n            return [1, 0];\n          case UP_ARROW:\n            return [0, 1];\n          case RIGHT_ARROW:\n            return [-1, 0];\n          case DOWN_ARROW:\n            return [0, -1];\n        }\n      }\n    }\n    function keyMove(movement) {\n      var deltaX = movement[0],\n        deltaY = movement[1],\n        newCss = {};\n      assignTransformCoordinates(deltaX, deltaY);\n      newCss[CSS_TRANSFORM] = transform.toString();\n      css(self.elements.preview, newCss);\n      _updateOverlay.call(self);\n      document.body.style[CSS_USERSELECT] = '';\n      _updateCenterPoint.call(self);\n      _triggerUpdate.call(self);\n      originalDistance = 0;\n    }\n    function mouseDown(ev) {\n      if (ev.button !== undefined && ev.button !== 0) return;\n      ev.preventDefault();\n      if (isDragging) return;\n      isDragging = true;\n      originalX = ev.pageX;\n      originalY = ev.pageY;\n      if (ev.touches) {\n        var touches = ev.touches[0];\n        originalX = touches.pageX;\n        originalY = touches.pageY;\n      }\n      toggleGrabState(isDragging);\n      transform = Transform.parse(self.elements.preview);\n      window.addEventListener('mousemove', mouseMove);\n      window.addEventListener('touchmove', mouseMove);\n      window.addEventListener('mouseup', mouseUp);\n      window.addEventListener('touchend', mouseUp);\n      document.body.style[CSS_USERSELECT] = 'none';\n      vpRect = self.elements.viewport.getBoundingClientRect();\n    }\n    function mouseMove(ev) {\n      ev.preventDefault();\n      var pageX = ev.pageX,\n        pageY = ev.pageY;\n      if (ev.touches) {\n        var touches = ev.touches[0];\n        pageX = touches.pageX;\n        pageY = touches.pageY;\n      }\n      var deltaX = pageX - originalX,\n        deltaY = pageY - originalY,\n        newCss = {};\n      if (ev.type === 'touchmove') {\n        if (ev.touches.length > 1) {\n          var touch1 = ev.touches[0];\n          var touch2 = ev.touches[1];\n          var dist = Math.sqrt((touch1.pageX - touch2.pageX) * (touch1.pageX - touch2.pageX) + (touch1.pageY - touch2.pageY) * (touch1.pageY - touch2.pageY));\n          if (!originalDistance) {\n            originalDistance = dist / self._currentZoom;\n          }\n          var scale = dist / originalDistance;\n          _setZoomerVal.call(self, scale);\n          dispatchChange(self.elements.zoomer);\n          return;\n        }\n      }\n      assignTransformCoordinates(deltaX, deltaY);\n      newCss[CSS_TRANSFORM] = transform.toString();\n      css(self.elements.preview, newCss);\n      _updateOverlay.call(self);\n      originalY = pageY;\n      originalX = pageX;\n    }\n    function mouseUp() {\n      isDragging = false;\n      toggleGrabState(isDragging);\n      window.removeEventListener('mousemove', mouseMove);\n      window.removeEventListener('touchmove', mouseMove);\n      window.removeEventListener('mouseup', mouseUp);\n      window.removeEventListener('touchend', mouseUp);\n      document.body.style[CSS_USERSELECT] = '';\n      _updateCenterPoint.call(self);\n      _triggerUpdate.call(self);\n      originalDistance = 0;\n    }\n    self.elements.overlay.addEventListener('mousedown', mouseDown);\n    self.elements.viewport.addEventListener('keydown', keyDown);\n    self.elements.overlay.addEventListener('touchstart', mouseDown);\n  }\n  function _updateOverlay() {\n    if (!this.elements) return; // since this is debounced, it can be fired after destroy\n    var self = this,\n      boundRect = self.elements.boundary.getBoundingClientRect(),\n      imgData = self.elements.preview.getBoundingClientRect();\n    css(self.elements.overlay, {\n      width: imgData.width + 'px',\n      height: imgData.height + 'px',\n      top: imgData.top - boundRect.top + 'px',\n      left: imgData.left - boundRect.left + 'px'\n    });\n  }\n  var _debouncedOverlay = debounce(_updateOverlay, 500);\n  function _triggerUpdate() {\n    var self = this,\n      data = self.get();\n    if (!_isVisible.call(self)) {\n      return;\n    }\n    self.options.update.call(self, data);\n    if (self.$ && typeof Prototype === 'undefined') {\n      self.$(self.element).trigger('update.croppie', data);\n    } else {\n      var ev;\n      if (window.CustomEvent) {\n        ev = new CustomEvent('update', {\n          detail: data\n        });\n      } else {\n        ev = document.createEvent('CustomEvent');\n        ev.initCustomEvent('update', true, true, data);\n      }\n      self.element.dispatchEvent(ev);\n    }\n  }\n  function _isVisible() {\n    return this.elements.preview.offsetHeight > 0 && this.elements.preview.offsetWidth > 0;\n  }\n  function _updatePropertiesFromImage() {\n    var self = this,\n      initialZoom = 1,\n      cssReset = {},\n      img = self.elements.preview,\n      imgData,\n      transformReset = new Transform(0, 0, initialZoom),\n      originReset = new TransformOrigin(),\n      isVisible = _isVisible.call(self);\n    if (!isVisible || self.data.bound) {\n      // if the croppie isn't visible or it doesn't need binding\n      return;\n    }\n    self.data.bound = true;\n    cssReset[CSS_TRANSFORM] = transformReset.toString();\n    cssReset[CSS_TRANS_ORG] = originReset.toString();\n    cssReset['opacity'] = 1;\n    css(img, cssReset);\n    imgData = self.elements.preview.getBoundingClientRect();\n    self._originalImageWidth = imgData.width;\n    self._originalImageHeight = imgData.height;\n    self.data.orientation = _hasExif.call(self) ? getExifOrientation(self.elements.img) : self.data.orientation;\n    if (self.options.enableZoom) {\n      _updateZoomLimits.call(self, true);\n    } else {\n      self._currentZoom = initialZoom;\n    }\n    transformReset.scale = self._currentZoom;\n    cssReset[CSS_TRANSFORM] = transformReset.toString();\n    css(img, cssReset);\n    if (self.data.points.length) {\n      _bindPoints.call(self, self.data.points);\n    } else {\n      _centerImage.call(self);\n    }\n    _updateCenterPoint.call(self);\n    _updateOverlay.call(self);\n  }\n  function _updateZoomLimits(initial) {\n    var self = this,\n      minZoom = Math.max(self.options.minZoom, 0) || 0,\n      maxZoom = self.options.maxZoom || 1.5,\n      initialZoom,\n      defaultInitialZoom,\n      zoomer = self.elements.zoomer,\n      scale = parseFloat(zoomer.value),\n      boundaryData = self.elements.boundary.getBoundingClientRect(),\n      imgData = naturalImageDimensions(self.elements.img, self.data.orientation),\n      vpData = self.elements.viewport.getBoundingClientRect(),\n      minW,\n      minH;\n    if (self.options.enforceBoundary) {\n      minW = vpData.width / imgData.width;\n      minH = vpData.height / imgData.height;\n      minZoom = Math.max(minW, minH);\n    }\n    if (minZoom >= maxZoom) {\n      maxZoom = minZoom + 1;\n    }\n    zoomer.min = fix(minZoom, 4);\n    zoomer.max = fix(maxZoom, 4);\n    if (!initial && (scale < zoomer.min || scale > zoomer.max)) {\n      _setZoomerVal.call(self, scale < zoomer.min ? zoomer.min : zoomer.max);\n    } else if (initial) {\n      defaultInitialZoom = Math.max(boundaryData.width / imgData.width, boundaryData.height / imgData.height);\n      initialZoom = self.data.boundZoom !== null ? self.data.boundZoom : defaultInitialZoom;\n      _setZoomerVal.call(self, initialZoom);\n    }\n    dispatchChange(zoomer);\n  }\n  function _bindPoints(points) {\n    if (points.length !== 4) {\n      throw \"Croppie - Invalid number of points supplied: \" + points;\n    }\n    var self = this,\n      pointsWidth = points[2] - points[0],\n      // pointsHeight = points[3] - points[1],\n      vpData = self.elements.viewport.getBoundingClientRect(),\n      boundRect = self.elements.boundary.getBoundingClientRect(),\n      vpOffset = {\n        left: vpData.left - boundRect.left,\n        top: vpData.top - boundRect.top\n      },\n      scale = vpData.width / pointsWidth,\n      originTop = points[1],\n      originLeft = points[0],\n      transformTop = -1 * points[1] + vpOffset.top,\n      transformLeft = -1 * points[0] + vpOffset.left,\n      newCss = {};\n    newCss[CSS_TRANS_ORG] = originLeft + 'px ' + originTop + 'px';\n    newCss[CSS_TRANSFORM] = new Transform(transformLeft, transformTop, scale).toString();\n    css(self.elements.preview, newCss);\n    _setZoomerVal.call(self, scale);\n    self._currentZoom = scale;\n  }\n  function _centerImage() {\n    var self = this,\n      imgDim = self.elements.preview.getBoundingClientRect(),\n      vpDim = self.elements.viewport.getBoundingClientRect(),\n      boundDim = self.elements.boundary.getBoundingClientRect(),\n      vpLeft = vpDim.left - boundDim.left,\n      vpTop = vpDim.top - boundDim.top,\n      w = vpLeft - (imgDim.width - vpDim.width) / 2,\n      h = vpTop - (imgDim.height - vpDim.height) / 2,\n      transform = new Transform(w, h, self._currentZoom);\n    css(self.elements.preview, CSS_TRANSFORM, transform.toString());\n  }\n  function _transferImageToCanvas(customOrientation) {\n    var self = this,\n      canvas = self.elements.canvas,\n      img = self.elements.img,\n      ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    canvas.width = img.width;\n    canvas.height = img.height;\n    var orientation = self.options.enableOrientation && customOrientation || getExifOrientation(img);\n    drawCanvas(canvas, img, orientation);\n  }\n  function _getCanvas(data) {\n    var self = this,\n      points = data.points,\n      left = num(points[0]),\n      top = num(points[1]),\n      right = num(points[2]),\n      bottom = num(points[3]),\n      width = right - left,\n      height = bottom - top,\n      circle = data.circle,\n      canvas = document.createElement('canvas'),\n      ctx = canvas.getContext('2d'),\n      startX = 0,\n      startY = 0,\n      canvasWidth = data.outputWidth || width,\n      canvasHeight = data.outputHeight || height;\n    canvas.width = canvasWidth;\n    canvas.height = canvasHeight;\n    if (data.backgroundColor) {\n      ctx.fillStyle = data.backgroundColor;\n      ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n    }\n\n    // By default assume we're going to draw the entire\n    // source image onto the destination canvas.\n    var sx = left,\n      sy = top,\n      sWidth = width,\n      sHeight = height,\n      dx = 0,\n      dy = 0,\n      dWidth = canvasWidth,\n      dHeight = canvasHeight;\n\n    //\n    // Do not go outside of the original image's bounds along the x-axis.\n    // Handle translations when projecting onto the destination canvas.\n    //\n\n    // The smallest possible source x-position is 0.\n    if (left < 0) {\n      sx = 0;\n      dx = Math.abs(left) / width * canvasWidth;\n    }\n\n    // The largest possible source width is the original image's width.\n    if (sWidth + sx > self._originalImageWidth) {\n      sWidth = self._originalImageWidth - sx;\n      dWidth = sWidth / width * canvasWidth;\n    }\n\n    //\n    // Do not go outside of the original image's bounds along the y-axis.\n    //\n\n    // The smallest possible source y-position is 0.\n    if (top < 0) {\n      sy = 0;\n      dy = Math.abs(top) / height * canvasHeight;\n    }\n\n    // The largest possible source height is the original image's height.\n    if (sHeight + sy > self._originalImageHeight) {\n      sHeight = self._originalImageHeight - sy;\n      dHeight = sHeight / height * canvasHeight;\n    }\n\n    // console.table({ left, right, top, bottom, canvasWidth, canvasHeight, width, height, startX, startY, circle, sx, sy, dx, dy, sWidth, sHeight, dWidth, dHeight });\n\n    ctx.drawImage(this.elements.preview, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);\n    if (circle) {\n      ctx.fillStyle = '#fff';\n      ctx.globalCompositeOperation = 'destination-in';\n      ctx.beginPath();\n      ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, 0, Math.PI * 2, true);\n      ctx.closePath();\n      ctx.fill();\n    }\n    return canvas;\n  }\n  function _getHtmlResult(data) {\n    var points = data.points,\n      div = document.createElement('div'),\n      img = document.createElement('img'),\n      width = points[2] - points[0],\n      height = points[3] - points[1];\n    addClass(div, 'croppie-result');\n    div.appendChild(img);\n    css(img, {\n      left: -1 * points[0] + 'px',\n      top: -1 * points[1] + 'px'\n    });\n    img.src = data.url;\n    css(div, {\n      width: width + 'px',\n      height: height + 'px'\n    });\n    return div;\n  }\n  function _getBase64Result(data) {\n    return _getCanvas.call(this, data).toDataURL(data.format, data.quality);\n  }\n  function _getBlobResult(data) {\n    var self = this;\n    return new Promise(function (resolve) {\n      _getCanvas.call(self, data).toBlob(function (blob) {\n        resolve(blob);\n      }, data.format, data.quality);\n    });\n  }\n  function _replaceImage(img) {\n    if (this.elements.img.parentNode) {\n      Array.prototype.forEach.call(this.elements.img.classList, function (c) {\n        img.classList.add(c);\n      });\n      this.elements.img.parentNode.replaceChild(img, this.elements.img);\n      this.elements.preview = img; // if the img is attached to the DOM, they're not using the canvas\n    }\n\n    this.elements.img = img;\n  }\n  function _bind(options, cb) {\n    var self = this,\n      url,\n      points = [],\n      zoom = null,\n      hasExif = _hasExif.call(self);\n    if (typeof options === 'string') {\n      url = options;\n      options = {};\n    } else if (Array.isArray(options)) {\n      points = options.slice();\n    } else if (typeof options === 'undefined' && self.data.url) {\n      //refreshing\n      _updatePropertiesFromImage.call(self);\n      _triggerUpdate.call(self);\n      return null;\n    } else {\n      url = options.url;\n      points = options.points || [];\n      zoom = typeof options.zoom === 'undefined' ? null : options.zoom;\n    }\n    self.data.bound = false;\n    self.data.url = url || self.data.url;\n    self.data.boundZoom = zoom;\n    return loadImage(url, hasExif).then(function (img) {\n      _replaceImage.call(self, img);\n      if (!points.length) {\n        var natDim = naturalImageDimensions(img);\n        var rect = self.elements.viewport.getBoundingClientRect();\n        var aspectRatio = rect.width / rect.height;\n        var imgAspectRatio = natDim.width / natDim.height;\n        var width, height;\n        if (imgAspectRatio > aspectRatio) {\n          height = natDim.height;\n          width = height * aspectRatio;\n        } else {\n          width = natDim.width;\n          height = natDim.height / aspectRatio;\n        }\n        var x0 = (natDim.width - width) / 2;\n        var y0 = (natDim.height - height) / 2;\n        var x1 = x0 + width;\n        var y1 = y0 + height;\n        self.data.points = [x0, y0, x1, y1];\n      } else if (self.options.relative) {\n        points = [points[0] * img.naturalWidth / 100, points[1] * img.naturalHeight / 100, points[2] * img.naturalWidth / 100, points[3] * img.naturalHeight / 100];\n      }\n      self.data.orientation = options.orientation || 1;\n      self.data.points = points.map(function (p) {\n        return parseFloat(p);\n      });\n      if (self.options.useCanvas) {\n        _transferImageToCanvas.call(self, self.data.orientation);\n      }\n      _updatePropertiesFromImage.call(self);\n      _triggerUpdate.call(self);\n      cb && cb();\n    });\n  }\n  function fix(v, decimalPoints) {\n    return parseFloat(v).toFixed(decimalPoints || 0);\n  }\n  function _get() {\n    var self = this,\n      imgData = self.elements.preview.getBoundingClientRect(),\n      vpData = self.elements.viewport.getBoundingClientRect(),\n      x1 = vpData.left - imgData.left,\n      y1 = vpData.top - imgData.top,\n      widthDiff = (vpData.width - self.elements.viewport.offsetWidth) / 2,\n      //border\n      heightDiff = (vpData.height - self.elements.viewport.offsetHeight) / 2,\n      x2 = x1 + self.elements.viewport.offsetWidth + widthDiff,\n      y2 = y1 + self.elements.viewport.offsetHeight + heightDiff,\n      scale = self._currentZoom;\n    if (scale === Infinity || isNaN(scale)) {\n      scale = 1;\n    }\n    var max = self.options.enforceBoundary ? 0 : Number.NEGATIVE_INFINITY;\n    x1 = Math.max(max, x1 / scale);\n    y1 = Math.max(max, y1 / scale);\n    x2 = Math.max(max, x2 / scale);\n    y2 = Math.max(max, y2 / scale);\n    return {\n      points: [fix(x1), fix(y1), fix(x2), fix(y2)],\n      zoom: scale,\n      orientation: self.data.orientation\n    };\n  }\n  var RESULT_DEFAULTS = {\n      type: 'canvas',\n      format: 'png',\n      quality: 1\n    },\n    RESULT_FORMATS = ['jpeg', 'webp', 'png'];\n  function _result(options) {\n    var self = this,\n      data = _get.call(self),\n      opts = deepExtend(clone(RESULT_DEFAULTS), clone(options)),\n      resultType = typeof options === 'string' ? options : opts.type || 'base64',\n      size = opts.size || 'viewport',\n      format = opts.format,\n      quality = opts.quality,\n      backgroundColor = opts.backgroundColor,\n      circle = typeof opts.circle === 'boolean' ? opts.circle : self.options.viewport.type === 'circle',\n      vpRect = self.elements.viewport.getBoundingClientRect(),\n      ratio = vpRect.width / vpRect.height,\n      prom;\n    if (size === 'viewport') {\n      data.outputWidth = vpRect.width;\n      data.outputHeight = vpRect.height;\n    } else if (typeof size === 'object') {\n      if (size.width && size.height) {\n        data.outputWidth = size.width;\n        data.outputHeight = size.height;\n      } else if (size.width) {\n        data.outputWidth = size.width;\n        data.outputHeight = size.width / ratio;\n      } else if (size.height) {\n        data.outputWidth = size.height * ratio;\n        data.outputHeight = size.height;\n      }\n    }\n    if (RESULT_FORMATS.indexOf(format) > -1) {\n      data.format = 'image/' + format;\n      data.quality = quality;\n    }\n    data.circle = circle;\n    data.url = self.data.url;\n    data.backgroundColor = backgroundColor;\n    prom = new Promise(function (resolve) {\n      switch (resultType.toLowerCase()) {\n        case 'rawcanvas':\n          resolve(_getCanvas.call(self, data));\n          break;\n        case 'canvas':\n        case 'base64':\n          resolve(_getBase64Result.call(self, data));\n          break;\n        case 'blob':\n          _getBlobResult.call(self, data).then(resolve);\n          break;\n        default:\n          resolve(_getHtmlResult.call(self, data));\n          break;\n      }\n    });\n    return prom;\n  }\n  function _refresh() {\n    _updatePropertiesFromImage.call(this);\n  }\n  function _rotate(deg) {\n    if (!this.options.useCanvas || !this.options.enableOrientation) {\n      throw 'Croppie: Cannot rotate without enableOrientation && EXIF.js included';\n    }\n    var self = this,\n      canvas = self.elements.canvas;\n    self.data.orientation = getExifOffset(self.data.orientation, deg);\n    drawCanvas(canvas, self.elements.img, self.data.orientation);\n    _updateCenterPoint.call(self, true);\n    _updateZoomLimits.call(self);\n\n    // Reverses image dimensions if the degrees of rotation is not divisible by 180.\n    if (Math.abs(deg) / 90 % 2 === 1) {\n      var oldHeight = self._originalImageHeight;\n      var oldWidth = self._originalImageWidth;\n      self._originalImageWidth = oldHeight;\n      self._originalImageHeight = oldWidth;\n    }\n  }\n  function _destroy() {\n    var self = this;\n    self.element.removeChild(self.elements.boundary);\n    removeClass(self.element, 'croppie-container');\n    if (self.options.enableZoom) {\n      self.element.removeChild(self.elements.zoomerWrap);\n    }\n    delete self.elements;\n  }\n  if (typeof window !== 'undefined' && window.jQuery) {\n    var $ = window.jQuery;\n    $.fn.croppie = function (opts) {\n      var ot = typeof opts;\n      if (ot === 'string') {\n        var args = Array.prototype.slice.call(arguments, 1);\n        var singleInst = $(this).data('croppie');\n        if (opts === 'get') {\n          return singleInst.get();\n        } else if (opts === 'result') {\n          return singleInst.result.apply(singleInst, args);\n        } else if (opts === 'bind') {\n          return singleInst.bind.apply(singleInst, args);\n        }\n        return this.each(function () {\n          var i = $(this).data('croppie');\n          if (!i) return;\n          var method = i[opts];\n          if ($.isFunction(method)) {\n            method.apply(i, args);\n            if (opts === 'destroy') {\n              $(this).removeData('croppie');\n            }\n          } else {\n            throw 'Croppie ' + opts + ' method not found';\n          }\n        });\n      } else {\n        return this.each(function () {\n          var i = new Croppie(this, opts);\n          i.$ = $;\n          $(this).data('croppie', i);\n        });\n      }\n    };\n  }\n  function Croppie(element, opts) {\n    if (element.className.indexOf('croppie-container') > -1) {\n      throw new Error(\"Croppie: Can't initialize croppie more than once\");\n    }\n    this.element = element;\n    this.options = deepExtend(clone(Croppie.defaults), opts);\n    if (this.element.tagName.toLowerCase() === 'img') {\n      var origImage = this.element;\n      addClass(origImage, 'cr-original-image');\n      setAttributes(origImage, {\n        'aria-hidden': 'true',\n        'alt': ''\n      });\n      var replacementDiv = document.createElement('div');\n      this.element.parentNode.appendChild(replacementDiv);\n      replacementDiv.appendChild(origImage);\n      this.element = replacementDiv;\n      this.options.url = this.options.url || origImage.src;\n    }\n    _create.call(this);\n    if (this.options.url) {\n      var bindOpts = {\n        url: this.options.url,\n        points: this.options.points\n      };\n      delete this.options['url'];\n      delete this.options['points'];\n      _bind.call(this, bindOpts);\n    }\n  }\n  Croppie.defaults = {\n    viewport: {\n      width: 100,\n      height: 100,\n      type: 'square'\n    },\n    boundary: {},\n    orientationControls: {\n      enabled: true,\n      leftClass: '',\n      rightClass: ''\n    },\n    resizeControls: {\n      width: true,\n      height: true\n    },\n    customClass: '',\n    showZoomer: true,\n    enableZoom: true,\n    enableResize: false,\n    mouseWheelZoom: true,\n    enableExif: false,\n    enforceBoundary: true,\n    enableOrientation: false,\n    enableKeyMovement: true,\n    update: function () {}\n  };\n  Croppie.globals = {\n    translate: 'translate3d'\n  };\n  deepExtend(Croppie.prototype, {\n    bind: function (options, cb) {\n      return _bind.call(this, options, cb);\n    },\n    get: function () {\n      var data = _get.call(this);\n      var points = data.points;\n      if (this.options.relative) {\n        points[0] /= this.elements.img.naturalWidth / 100;\n        points[1] /= this.elements.img.naturalHeight / 100;\n        points[2] /= this.elements.img.naturalWidth / 100;\n        points[3] /= this.elements.img.naturalHeight / 100;\n      }\n      return data;\n    },\n    result: function (type) {\n      return _result.call(this, type);\n    },\n    refresh: function () {\n      return _refresh.call(this);\n    },\n    setZoom: function (v) {\n      _setZoomerVal.call(this, v);\n      dispatchChange(this.elements.zoomer);\n    },\n    rotate: function (deg) {\n      _rotate.call(this, deg);\n    },\n    destroy: function () {\n      return _destroy.call(this);\n    }\n  });\n  return Croppie;\n});","map":{"version":3,"names":["root","factory","define","amd","exports","nodeName","module","Croppie","self","Promise","a","b","apply","arguments","c","TypeError","_state","_value","_deferreds","i","e","f","d","push","k","onFulfilled","onRejected","resolve","reject","then","g","call","length","h","j","setTimeout","setImmediate","l","Array","isArray","Object","prototype","toString","all","slice","constructor","race","_setImmediateFn","window","CustomEvent","event","params","bubbles","cancelable","detail","undefined","evt","document","createEvent","initCustomEvent","Event","HTMLCanvasElement","toBlob","defineProperty","value","callback","type","quality","binStr","atob","toDataURL","split","len","arr","Uint8Array","charCodeAt","Blob","cssPrefixes","emptyStyles","createElement","style","EXIF_NORM","EXIF_FLIP","CSS_TRANS_ORG","CSS_TRANSFORM","CSS_USERSELECT","vendorPrefix","prop","capProp","toUpperCase","getExifOffset","ornt","rotate","indexOf","index","offset","deepExtend","destination","source","property","clone","object","debounce","func","wait","immediate","timeout","context","args","later","callNow","clearTimeout","dispatchChange","element","initEvent","dispatchEvent","fireEvent","css","el","styles","val","tmp","addClass","classList","add","className","removeClass","remove","replace","setAttributes","attrs","key","setAttribute","num","v","parseInt","loadImage","src","doExif","img","Image","opacity","_resolve","removeAttribute","match","onload","EXIF","getData","onerror","ev","naturalImageDimensions","w","naturalWidth","naturalHeight","orient","getExifOrientation","x","width","height","TRANSLATE_OPTS","suffix","Transform","y","scale","parseFloat","parse","fromMatrix","fromString","vals","substring","values","translate","globals","TransformOrigin","exifdata","Orientation","drawCanvas","canvas","orientation","ctx","getContext","save","Math","PI","drawImage","restore","_create","contClass","customViewportClass","options","viewport","boundary","overlay","bw","bh","useCanvas","enableOrientation","_hasExif","data","elements","preview","isNaN","appendChild","customClass","_initDraggable","enableZoom","_initializeZoom","enableResize","_initializeResize","enableExif","wrap","isDragging","direction","originalX","originalY","minSize","maxWidth","maxHeight","vr","hr","resizeControls","mouseDown","button","preventDefault","overlayRect","getBoundingClientRect","pageX","pageY","currentTarget","touches","addEventListener","mouseMove","mouseUp","body","deltaX","deltaY","newHeight","newWidth","_updateOverlay","_updateZoomLimits","_updateCenterPoint","_triggerUpdate","removeEventListener","_setZoomerVal","z","zoomer","fix","max","min","zoomerWrap","step","display","showZoomer","_currentZoom","change","_onZoom","origin","viewportRect","transform","scroll","delta","targetZoom","mouseWheelZoom","ctrlKey","wheelDelta","ui","vpRect","applyCss","transCss","enforceBoundary","boundaries","_getVirtualBoundaries","transBoundaries","oBoundaries","maxX","minX","maxY","minY","_debouncedOverlay","vpWidth","vpHeight","centerFromBoundaryX","clientWidth","centerFromBoundaryY","clientHeight","imgRect","curImgWidth","curImgHeight","halfWidth","halfHeight","originMinX","originMaxX","originMinY","originMaxY","vpData","pc","top","left","center","adj","cx","cy","tx","ty","newCss","originalDistance","assignTransformCoordinates","bottom","right","toggleGrabState","keyDown","LEFT_ARROW","UP_ARROW","RIGHT_ARROW","DOWN_ARROW","shiftKey","keyCode","zoom","setZoom","enableKeyMovement","movement","parseKeyDown","keyMove","touch1","touch2","dist","sqrt","boundRect","imgData","get","_isVisible","update","$","Prototype","trigger","offsetHeight","offsetWidth","_updatePropertiesFromImage","initialZoom","cssReset","transformReset","originReset","isVisible","bound","_originalImageWidth","_originalImageHeight","points","_bindPoints","_centerImage","initial","minZoom","maxZoom","defaultInitialZoom","boundaryData","minW","minH","boundZoom","pointsWidth","vpOffset","originTop","originLeft","transformTop","transformLeft","imgDim","vpDim","boundDim","vpLeft","vpTop","_transferImageToCanvas","customOrientation","clearRect","_getCanvas","circle","startX","startY","canvasWidth","outputWidth","canvasHeight","outputHeight","backgroundColor","fillStyle","fillRect","sx","sy","sWidth","sHeight","dx","dy","dWidth","dHeight","abs","globalCompositeOperation","beginPath","arc","closePath","fill","_getHtmlResult","div","url","_getBase64Result","format","_getBlobResult","blob","_replaceImage","parentNode","forEach","replaceChild","_bind","cb","hasExif","natDim","rect","aspectRatio","imgAspectRatio","x0","y0","x1","y1","relative","map","p","decimalPoints","toFixed","_get","widthDiff","heightDiff","x2","y2","Infinity","Number","NEGATIVE_INFINITY","RESULT_DEFAULTS","RESULT_FORMATS","_result","opts","resultType","size","ratio","prom","toLowerCase","_refresh","_rotate","deg","oldHeight","oldWidth","_destroy","removeChild","jQuery","fn","croppie","ot","singleInst","result","bind","each","method","isFunction","removeData","Error","defaults","tagName","origImage","replacementDiv","bindOpts","orientationControls","enabled","leftClass","rightClass","refresh","destroy"],"sources":["/home/digifemmes-22lab149/Bureau/soutramoi_app/node_modules/croppie/croppie.js"],"sourcesContent":["/*************************\r\n * Croppie\r\n * Copyright 2019\r\n * Foliotek\r\n * Version: 2.6.5\r\n *************************/\r\n(function (root, factory) {\r\n    if (typeof define === 'function' && define.amd) {\r\n        // AMD. Register as an anonymous module.\r\n        define(factory);\r\n    } else if (typeof exports === 'object' && typeof exports.nodeName !== 'string') {\r\n        // CommonJS\r\n        module.exports = factory();\r\n    } else {\r\n        // Browser globals\r\n        root.Croppie = factory();\r\n    }\r\n}(typeof self !== 'undefined' ? self : this, function () {\r\n\r\n    /* Polyfills */\r\n    if (typeof Promise !== 'function') {\r\n        /*! promise-polyfill 3.1.0 */\r\n        !function(a){function b(a,b){return function(){a.apply(b,arguments)}}function c(a){if(\"object\"!==typeof this)throw new TypeError(\"Promises must be constructed via new\");if(\"function\"!==typeof a)throw new TypeError(\"not a function\");this._state=null,this._value=null,this._deferreds=[],i(a,b(e,this),b(f,this))}function d(a){var b=this;return null===this._state?void this._deferreds.push(a):void k(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)return void(b._state?a.resolve:a.reject)(b._value);var d;try{d=c(b._value)}catch(e){return void a.reject(e)}a.resolve(d)})}function e(a){try{if(a===this)throw new TypeError(\"A promise cannot be resolved with itself.\");if(a&&(\"object\"===typeof a||\"function\"===typeof a)){var c=a.then;if(\"function\"===typeof c)return void i(b(c,a),b(e,this),b(f,this))}this._state=!0,this._value=a,g.call(this)}catch(d){f.call(this,d)}}function f(a){this._state=!1,this._value=a,g.call(this)}function g(){for(var a=0,b=this._deferreds.length;b>a;a++)d.call(this,this._deferreds[a]);this._deferreds=null}function h(a,b,c,d){this.onFulfilled=\"function\"===typeof a?a:null,this.onRejected=\"function\"===typeof b?b:null,this.resolve=c,this.reject=d}function i(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}var j=setTimeout,k=\"function\"===typeof setImmediate&&setImmediate||function(a){j(a,1)},l=Array.isArray||function(a){return\"[object Array]\"===Object.prototype.toString.call(a)};c.prototype[\"catch\"]=function(a){return this.then(null,a)},c.prototype.then=function(a,b){var e=this;return new c(function(c,f){d.call(e,new h(a,b,c,f))})},c.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&l(arguments[0])?arguments[0]:arguments);return new c(function(b,c){function d(f,g){try{if(g&&(\"object\"===typeof g||\"function\"===typeof g)){var h=g.then;if(\"function\"===typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(i){c(i)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},c.resolve=function(a){return a&&\"object\"===typeof a&&a.constructor===c?a:new c(function(b){b(a)})},c.reject=function(a){return new c(function(b,c){c(a)})},c.race=function(a){return new c(function(b,c){for(var d=0,e=a.length;e>d;d++)a[d].then(b,c)})},c._setImmediateFn=function(a){k=a},\"undefined\"!==typeof module&&module.exports?module.exports=c:a.Promise||(a.Promise=c)}(this);\r\n    }\r\n\r\n    if (typeof window !== 'undefined' && typeof window.CustomEvent !== \"function\") {\r\n        (function(){\r\n            function CustomEvent ( event, params ) {\r\n                params = params || { bubbles: false, cancelable: false, detail: undefined };\r\n                var evt = document.createEvent( 'CustomEvent' );\r\n                evt.initCustomEvent( event, params.bubbles, params.cancelable, params.detail );\r\n                return evt;\r\n            }\r\n            CustomEvent.prototype = window.Event.prototype;\r\n            window.CustomEvent = CustomEvent;\r\n        }());\r\n    }\r\n\r\n    if (typeof HTMLCanvasElement !== 'undefined' && !HTMLCanvasElement.prototype.toBlob) {\r\n        Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\r\n            value: function (callback, type, quality) {\r\n                var binStr = atob( this.toDataURL(type, quality).split(',')[1] ),\r\n                len = binStr.length,\r\n                arr = new Uint8Array(len);\r\n\r\n                for (var i=0; i<len; i++ ) {\r\n                    arr[i] = binStr.charCodeAt(i);\r\n                }\r\n\r\n                callback( new Blob( [arr], {type: type || 'image/png'} ) );\r\n            }\r\n        });\r\n    }\r\n    /* End Polyfills */\r\n\r\n    var cssPrefixes = ['Webkit', 'Moz', 'ms'],\r\n        emptyStyles = typeof document !== 'undefined' ? document.createElement('div').style : {},\r\n        EXIF_NORM = [1,8,3,6],\r\n        EXIF_FLIP = [2,7,4,5],\r\n        CSS_TRANS_ORG,\r\n        CSS_TRANSFORM,\r\n        CSS_USERSELECT;\r\n\r\n    function vendorPrefix(prop) {\r\n        if (prop in emptyStyles) {\r\n            return prop;\r\n        }\r\n\r\n        var capProp = prop[0].toUpperCase() + prop.slice(1),\r\n            i = cssPrefixes.length;\r\n\r\n        while (i--) {\r\n            prop = cssPrefixes[i] + capProp;\r\n            if (prop in emptyStyles) {\r\n                return prop;\r\n            }\r\n        }\r\n    }\r\n\r\n    CSS_TRANSFORM = vendorPrefix('transform');\r\n    CSS_TRANS_ORG = vendorPrefix('transformOrigin');\r\n    CSS_USERSELECT = vendorPrefix('userSelect');\r\n\r\n    function getExifOffset(ornt, rotate) {\r\n        var arr = EXIF_NORM.indexOf(ornt) > -1 ? EXIF_NORM : EXIF_FLIP,\r\n            index = arr.indexOf(ornt),\r\n            offset = (rotate / 90) % arr.length;// 180 = 2%4 = 2 shift exif by 2 indexes\r\n\r\n        return arr[(arr.length + index + (offset % arr.length)) % arr.length];\r\n    }\r\n\r\n    // Credits to : Andrew Dupont - http://andrewdupont.net/2009/08/28/deep-extending-objects-in-javascript/\r\n    function deepExtend(destination, source) {\r\n        destination = destination || {};\r\n        for (var property in source) {\r\n            if (source[property] && source[property].constructor && source[property].constructor === Object) {\r\n                destination[property] = destination[property] || {};\r\n                deepExtend(destination[property], source[property]);\r\n            } else {\r\n                destination[property] = source[property];\r\n            }\r\n        }\r\n        return destination;\r\n    }\r\n\r\n    function clone(object) {\r\n        return deepExtend({}, object);\r\n    }\r\n\r\n    function debounce(func, wait, immediate) {\r\n        var timeout;\r\n        return function () {\r\n            var context = this, args = arguments;\r\n            var later = function () {\r\n                timeout = null;\r\n                if (!immediate) func.apply(context, args);\r\n            };\r\n            var callNow = immediate && !timeout;\r\n            clearTimeout(timeout);\r\n            timeout = setTimeout(later, wait);\r\n            if (callNow) func.apply(context, args);\r\n        };\r\n    }\r\n\r\n    function dispatchChange(element) {\r\n        if (\"createEvent\" in document) {\r\n            var evt = document.createEvent(\"HTMLEvents\");\r\n            evt.initEvent(\"change\", false, true);\r\n            element.dispatchEvent(evt);\r\n        }\r\n        else {\r\n            element.fireEvent(\"onchange\");\r\n        }\r\n    }\r\n\r\n    //http://jsperf.com/vanilla-css\r\n    function css(el, styles, val) {\r\n        if (typeof (styles) === 'string') {\r\n            var tmp = styles;\r\n            styles = {};\r\n            styles[tmp] = val;\r\n        }\r\n\r\n        for (var prop in styles) {\r\n            el.style[prop] = styles[prop];\r\n        }\r\n    }\r\n\r\n    function addClass(el, c) {\r\n        if (el.classList) {\r\n            el.classList.add(c);\r\n        }\r\n        else {\r\n            el.className += ' ' + c;\r\n        }\r\n    }\r\n\r\n    function removeClass(el, c) {\r\n        if (el.classList) {\r\n            el.classList.remove(c);\r\n        }\r\n        else {\r\n            el.className = el.className.replace(c, '');\r\n        }\r\n    }\r\n\r\n    function setAttributes(el, attrs) {\r\n        for (var key in attrs) {\r\n            el.setAttribute(key, attrs[key]);\r\n        }\r\n    }\r\n\r\n    function num(v) {\r\n        return parseInt(v, 10);\r\n    }\r\n\r\n    /* Utilities */\r\n    function loadImage(src, doExif) {\r\n        if (!src) { throw 'Source image missing'; }\r\n        \r\n        var img = new Image();\r\n        img.style.opacity = '0';\r\n        return new Promise(function (resolve, reject) {\r\n            function _resolve() {\r\n                img.style.opacity = '1';\r\n                setTimeout(function () {\r\n                    resolve(img);\r\n                }, 1);\r\n            }\r\n\r\n            img.removeAttribute('crossOrigin');\r\n            if (src.match(/^https?:\\/\\/|^\\/\\//)) {\r\n                img.setAttribute('crossOrigin', 'anonymous');\r\n            }\r\n\r\n            img.onload = function () {\r\n                if (doExif) {\r\n                    EXIF.getData(img, function () {\r\n                        _resolve();\r\n                    });\r\n                }\r\n                else {\r\n                    _resolve();\r\n                }\r\n            };\r\n            img.onerror = function (ev) {\r\n                img.style.opacity = 1;\r\n                setTimeout(function () {\r\n                    reject(ev);\r\n                }, 1);\r\n            };\r\n            img.src = src;\r\n        });\r\n    }\r\n\r\n    function naturalImageDimensions(img, ornt) {\r\n        var w = img.naturalWidth;\r\n        var h = img.naturalHeight;\r\n        var orient = ornt || getExifOrientation(img);\r\n        if (orient && orient >= 5) {\r\n            var x= w;\r\n            w = h;\r\n            h = x;\r\n        }\r\n        return { width: w, height: h };\r\n    }\r\n\r\n    /* CSS Transform Prototype */\r\n    var TRANSLATE_OPTS = {\r\n        'translate3d': {\r\n            suffix: ', 0px'\r\n        },\r\n        'translate': {\r\n            suffix: ''\r\n        }\r\n    };\r\n    var Transform = function (x, y, scale) {\r\n        this.x = parseFloat(x);\r\n        this.y = parseFloat(y);\r\n        this.scale = parseFloat(scale);\r\n    };\r\n\r\n    Transform.parse = function (v) {\r\n        if (v.style) {\r\n            return Transform.parse(v.style[CSS_TRANSFORM]);\r\n        }\r\n        else if (v.indexOf('matrix') > -1 || v.indexOf('none') > -1) {\r\n            return Transform.fromMatrix(v);\r\n        }\r\n        else {\r\n            return Transform.fromString(v);\r\n        }\r\n    };\r\n\r\n    Transform.fromMatrix = function (v) {\r\n        var vals = v.substring(7).split(',');\r\n        if (!vals.length || v === 'none') {\r\n            vals = [1, 0, 0, 1, 0, 0];\r\n        }\r\n\r\n        return new Transform(num(vals[4]), num(vals[5]), parseFloat(vals[0]));\r\n    };\r\n\r\n    Transform.fromString = function (v) {\r\n        var values = v.split(') '),\r\n            translate = values[0].substring(Croppie.globals.translate.length + 1).split(','),\r\n            scale = values.length > 1 ? values[1].substring(6) : 1,\r\n            x = translate.length > 1 ? translate[0] : 0,\r\n            y = translate.length > 1 ? translate[1] : 0;\r\n\r\n        return new Transform(x, y, scale);\r\n    };\r\n\r\n    Transform.prototype.toString = function () {\r\n        var suffix = TRANSLATE_OPTS[Croppie.globals.translate].suffix || '';\r\n        return Croppie.globals.translate + '(' + this.x + 'px, ' + this.y + 'px' + suffix + ') scale(' + this.scale + ')';\r\n    };\r\n\r\n    var TransformOrigin = function (el) {\r\n        if (!el || !el.style[CSS_TRANS_ORG]) {\r\n            this.x = 0;\r\n            this.y = 0;\r\n            return;\r\n        }\r\n        var css = el.style[CSS_TRANS_ORG].split(' ');\r\n        this.x = parseFloat(css[0]);\r\n        this.y = parseFloat(css[1]);\r\n    };\r\n\r\n    TransformOrigin.prototype.toString = function () {\r\n        return this.x + 'px ' + this.y + 'px';\r\n    };\r\n\r\n    function getExifOrientation (img) {\r\n        return img.exifdata && img.exifdata.Orientation ? num(img.exifdata.Orientation) : 1;\r\n    }\r\n\r\n    function drawCanvas(canvas, img, orientation) {\r\n        var width = img.width,\r\n            height = img.height,\r\n            ctx = canvas.getContext('2d');\r\n\r\n        canvas.width = img.width;\r\n        canvas.height = img.height;\r\n\r\n        ctx.save();\r\n        switch (orientation) {\r\n          case 2:\r\n             ctx.translate(width, 0);\r\n             ctx.scale(-1, 1);\r\n             break;\r\n\r\n          case 3:\r\n              ctx.translate(width, height);\r\n              ctx.rotate(180*Math.PI/180);\r\n              break;\r\n\r\n          case 4:\r\n              ctx.translate(0, height);\r\n              ctx.scale(1, -1);\r\n              break;\r\n\r\n          case 5:\r\n              canvas.width = height;\r\n              canvas.height = width;\r\n              ctx.rotate(90*Math.PI/180);\r\n              ctx.scale(1, -1);\r\n              break;\r\n\r\n          case 6:\r\n              canvas.width = height;\r\n              canvas.height = width;\r\n              ctx.rotate(90*Math.PI/180);\r\n              ctx.translate(0, -height);\r\n              break;\r\n\r\n          case 7:\r\n              canvas.width = height;\r\n              canvas.height = width;\r\n              ctx.rotate(-90*Math.PI/180);\r\n              ctx.translate(-width, height);\r\n              ctx.scale(1, -1);\r\n              break;\r\n\r\n          case 8:\r\n              canvas.width = height;\r\n              canvas.height = width;\r\n              ctx.translate(0, width);\r\n              ctx.rotate(-90*Math.PI/180);\r\n              break;\r\n        }\r\n        ctx.drawImage(img, 0,0, width, height);\r\n        ctx.restore();\r\n    }\r\n\r\n    /* Private Methods */\r\n    function _create() {\r\n        var self = this,\r\n            contClass = 'croppie-container',\r\n            customViewportClass = self.options.viewport.type ? 'cr-vp-' + self.options.viewport.type : null,\r\n            boundary, img, viewport, overlay, bw, bh;\r\n\r\n        self.options.useCanvas = self.options.enableOrientation || _hasExif.call(self);\r\n        // Properties on class\r\n        self.data = {};\r\n        self.elements = {};\r\n\r\n        boundary = self.elements.boundary = document.createElement('div');\r\n        viewport = self.elements.viewport = document.createElement('div');\r\n        img = self.elements.img = document.createElement('img');\r\n        overlay = self.elements.overlay = document.createElement('div');\r\n\r\n        if (self.options.useCanvas) {\r\n            self.elements.canvas = document.createElement('canvas');\r\n            self.elements.preview = self.elements.canvas;\r\n        }\r\n        else {\r\n            self.elements.preview = img;\r\n        }\r\n\r\n        addClass(boundary, 'cr-boundary');\r\n        boundary.setAttribute('aria-dropeffect', 'none');\r\n        bw = self.options.boundary.width;\r\n        bh = self.options.boundary.height;\r\n        css(boundary, {\r\n            width: (bw + (isNaN(bw) ? '' : 'px')),\r\n            height: (bh + (isNaN(bh) ? '' : 'px'))\r\n        });\r\n\r\n        addClass(viewport, 'cr-viewport');\r\n        if (customViewportClass) {\r\n            addClass(viewport, customViewportClass);\r\n        }\r\n        css(viewport, {\r\n            width: self.options.viewport.width + 'px',\r\n            height: self.options.viewport.height + 'px'\r\n        });\r\n        viewport.setAttribute('tabindex', 0);\r\n\r\n        addClass(self.elements.preview, 'cr-image');\r\n        setAttributes(self.elements.preview, { 'alt': 'preview', 'aria-grabbed': 'false' });\r\n        addClass(overlay, 'cr-overlay');\r\n\r\n        self.element.appendChild(boundary);\r\n        boundary.appendChild(self.elements.preview);\r\n        boundary.appendChild(viewport);\r\n        boundary.appendChild(overlay);\r\n\r\n        addClass(self.element, contClass);\r\n        if (self.options.customClass) {\r\n            addClass(self.element, self.options.customClass);\r\n        }\r\n\r\n        _initDraggable.call(this);\r\n\r\n        if (self.options.enableZoom) {\r\n            _initializeZoom.call(self);\r\n        }\r\n\r\n        // if (self.options.enableOrientation) {\r\n        //     _initRotationControls.call(self);\r\n        // }\r\n\r\n        if (self.options.enableResize) {\r\n            _initializeResize.call(self);\r\n        }\r\n    }\r\n\r\n    // function _initRotationControls () {\r\n    //     var self = this,\r\n    //         wrap, btnLeft, btnRight, iLeft, iRight;\r\n\r\n    //     wrap = document.createElement('div');\r\n    //     self.elements.orientationBtnLeft = btnLeft = document.createElement('button');\r\n    //     self.elements.orientationBtnRight = btnRight = document.createElement('button');\r\n\r\n    //     wrap.appendChild(btnLeft);\r\n    //     wrap.appendChild(btnRight);\r\n\r\n    //     iLeft = document.createElement('i');\r\n    //     iRight = document.createElement('i');\r\n    //     btnLeft.appendChild(iLeft);\r\n    //     btnRight.appendChild(iRight);\r\n\r\n    //     addClass(wrap, 'cr-rotate-controls');\r\n    //     addClass(btnLeft, 'cr-rotate-l');\r\n    //     addClass(btnRight, 'cr-rotate-r');\r\n\r\n    //     self.elements.boundary.appendChild(wrap);\r\n\r\n    //     btnLeft.addEventListener('click', function () {\r\n    //         self.rotate(-90);\r\n    //     });\r\n    //     btnRight.addEventListener('click', function () {\r\n    //         self.rotate(90);\r\n    //     });\r\n    // }\r\n\r\n    function _hasExif() {\r\n        return this.options.enableExif && window.EXIF;\r\n    }\r\n\r\n    function _initializeResize () {\r\n        var self = this;\r\n        var wrap = document.createElement('div');\r\n        var isDragging = false;\r\n        var direction;\r\n        var originalX;\r\n        var originalY;\r\n        var minSize = 50;\r\n        var maxWidth;\r\n        var maxHeight;\r\n        var vr;\r\n        var hr;\r\n\r\n        addClass(wrap, 'cr-resizer');\r\n        css(wrap, {\r\n            width: this.options.viewport.width + 'px',\r\n            height: this.options.viewport.height + 'px'\r\n        });\r\n\r\n        if (this.options.resizeControls.height) {\r\n            vr = document.createElement('div');\r\n            addClass(vr, 'cr-resizer-vertical');\r\n            wrap.appendChild(vr);\r\n        }\r\n\r\n        if (this.options.resizeControls.width) {\r\n            hr = document.createElement('div');\r\n            addClass(hr, 'cr-resizer-horisontal');\r\n            wrap.appendChild(hr);\r\n        }\r\n\r\n        function mouseDown(ev) {\r\n            if (ev.button !== undefined && ev.button !== 0) return;\r\n\r\n            ev.preventDefault();\r\n            if (isDragging) {\r\n                return;\r\n            }\r\n\r\n            var overlayRect = self.elements.overlay.getBoundingClientRect();\r\n\r\n            isDragging = true;\r\n            originalX = ev.pageX;\r\n            originalY = ev.pageY;\r\n            direction = ev.currentTarget.className.indexOf('vertical') !== -1 ? 'v' : 'h';\r\n            maxWidth = overlayRect.width;\r\n            maxHeight = overlayRect.height;\r\n\r\n            if (ev.touches) {\r\n                var touches = ev.touches[0];\r\n                originalX = touches.pageX;\r\n                originalY = touches.pageY;\r\n            }\r\n\r\n            window.addEventListener('mousemove', mouseMove);\r\n            window.addEventListener('touchmove', mouseMove);\r\n            window.addEventListener('mouseup', mouseUp);\r\n            window.addEventListener('touchend', mouseUp);\r\n            document.body.style[CSS_USERSELECT] = 'none';\r\n        }\r\n\r\n        function mouseMove(ev) {\r\n            var pageX = ev.pageX;\r\n            var pageY = ev.pageY;\r\n\r\n            ev.preventDefault();\r\n\r\n            if (ev.touches) {\r\n                var touches = ev.touches[0];\r\n                pageX = touches.pageX;\r\n                pageY = touches.pageY;\r\n            }\r\n\r\n            var deltaX = pageX - originalX;\r\n            var deltaY = pageY - originalY;\r\n            var newHeight = self.options.viewport.height + deltaY;\r\n            var newWidth = self.options.viewport.width + deltaX;\r\n\r\n            if (direction === 'v' && newHeight >= minSize && newHeight <= maxHeight) {\r\n                css(wrap, {\r\n                    height: newHeight + 'px'\r\n                });\r\n\r\n                self.options.boundary.height += deltaY;\r\n                css(self.elements.boundary, {\r\n                    height: self.options.boundary.height + 'px'\r\n                });\r\n\r\n                self.options.viewport.height += deltaY;\r\n                css(self.elements.viewport, {\r\n                    height: self.options.viewport.height + 'px'\r\n                });\r\n            }\r\n            else if (direction === 'h' && newWidth >= minSize && newWidth <= maxWidth) {\r\n                css(wrap, {\r\n                    width: newWidth + 'px'\r\n                });\r\n\r\n                self.options.boundary.width += deltaX;\r\n                css(self.elements.boundary, {\r\n                    width: self.options.boundary.width + 'px'\r\n                });\r\n\r\n                self.options.viewport.width += deltaX;\r\n                css(self.elements.viewport, {\r\n                    width: self.options.viewport.width + 'px'\r\n                });\r\n            }\r\n\r\n            _updateOverlay.call(self);\r\n            _updateZoomLimits.call(self);\r\n            _updateCenterPoint.call(self);\r\n            _triggerUpdate.call(self);\r\n            originalY = pageY;\r\n            originalX = pageX;\r\n        }\r\n\r\n        function mouseUp() {\r\n            isDragging = false;\r\n            window.removeEventListener('mousemove', mouseMove);\r\n            window.removeEventListener('touchmove', mouseMove);\r\n            window.removeEventListener('mouseup', mouseUp);\r\n            window.removeEventListener('touchend', mouseUp);\r\n            document.body.style[CSS_USERSELECT] = '';\r\n        }\r\n\r\n        if (vr) {\r\n            vr.addEventListener('mousedown', mouseDown);\r\n            vr.addEventListener('touchstart', mouseDown);\r\n        }\r\n\r\n        if (hr) {\r\n            hr.addEventListener('mousedown', mouseDown);\r\n            hr.addEventListener('touchstart', mouseDown);\r\n        }\r\n\r\n        this.elements.boundary.appendChild(wrap);\r\n    }\r\n\r\n    function _setZoomerVal(v) {\r\n        if (this.options.enableZoom) {\r\n            var z = this.elements.zoomer,\r\n                val = fix(v, 4);\r\n\r\n            z.value = Math.max(parseFloat(z.min), Math.min(parseFloat(z.max), val)).toString();\r\n        }\r\n    }\r\n\r\n    function _initializeZoom() {\r\n        var self = this,\r\n            wrap = self.elements.zoomerWrap = document.createElement('div'),\r\n            zoomer = self.elements.zoomer = document.createElement('input');\r\n\r\n        addClass(wrap, 'cr-slider-wrap');\r\n        addClass(zoomer, 'cr-slider');\r\n        zoomer.type = 'range';\r\n        zoomer.step = '0.0001';\r\n        zoomer.value = '1';\r\n        zoomer.style.display = self.options.showZoomer ? '' : 'none';\r\n        zoomer.setAttribute('aria-label', 'zoom');\r\n\r\n        self.element.appendChild(wrap);\r\n        wrap.appendChild(zoomer);\r\n\r\n        self._currentZoom = 1;\r\n\r\n        function change() {\r\n            _onZoom.call(self, {\r\n                value: parseFloat(zoomer.value),\r\n                origin: new TransformOrigin(self.elements.preview),\r\n                viewportRect: self.elements.viewport.getBoundingClientRect(),\r\n                transform: Transform.parse(self.elements.preview)\r\n            });\r\n        }\r\n\r\n        function scroll(ev) {\r\n            var delta, targetZoom;\r\n\r\n            if(self.options.mouseWheelZoom === 'ctrl' && ev.ctrlKey !== true){\r\n              return 0;\r\n            } else if (ev.wheelDelta) {\r\n                delta = ev.wheelDelta / 1200; //wheelDelta min: -120 max: 120 // max x 10 x 2\r\n            } else if (ev.deltaY) {\r\n                delta = ev.deltaY / 1060; //deltaY min: -53 max: 53 // max x 10 x 2\r\n            } else if (ev.detail) {\r\n                delta = ev.detail / -60; //delta min: -3 max: 3 // max x 10 x 2\r\n            } else {\r\n                delta = 0;\r\n            }\r\n\r\n            targetZoom = self._currentZoom + (delta * self._currentZoom);\r\n\r\n            ev.preventDefault();\r\n            _setZoomerVal.call(self, targetZoom);\r\n            change.call(self);\r\n        }\r\n\r\n        self.elements.zoomer.addEventListener('input', change);// this is being fired twice on keypress\r\n        self.elements.zoomer.addEventListener('change', change);\r\n\r\n        if (self.options.mouseWheelZoom) {\r\n            self.elements.boundary.addEventListener('mousewheel', scroll);\r\n            self.elements.boundary.addEventListener('DOMMouseScroll', scroll);\r\n        }\r\n    }\r\n\r\n    function _onZoom(ui) {\r\n        var self = this,\r\n            transform = ui ? ui.transform : Transform.parse(self.elements.preview),\r\n            vpRect = ui ? ui.viewportRect : self.elements.viewport.getBoundingClientRect(),\r\n            origin = ui ? ui.origin : new TransformOrigin(self.elements.preview);\r\n\r\n        function applyCss() {\r\n            var transCss = {};\r\n            transCss[CSS_TRANSFORM] = transform.toString();\r\n            transCss[CSS_TRANS_ORG] = origin.toString();\r\n            css(self.elements.preview, transCss);\r\n        }\r\n\r\n        self._currentZoom = ui ? ui.value : self._currentZoom;\r\n        transform.scale = self._currentZoom;\r\n        self.elements.zoomer.setAttribute('aria-valuenow', self._currentZoom);\r\n        applyCss();\r\n\r\n        if (self.options.enforceBoundary) {\r\n            var boundaries = _getVirtualBoundaries.call(self, vpRect),\r\n                transBoundaries = boundaries.translate,\r\n                oBoundaries = boundaries.origin;\r\n\r\n            if (transform.x >= transBoundaries.maxX) {\r\n                origin.x = oBoundaries.minX;\r\n                transform.x = transBoundaries.maxX;\r\n            }\r\n\r\n            if (transform.x <= transBoundaries.minX) {\r\n                origin.x = oBoundaries.maxX;\r\n                transform.x = transBoundaries.minX;\r\n            }\r\n\r\n            if (transform.y >= transBoundaries.maxY) {\r\n                origin.y = oBoundaries.minY;\r\n                transform.y = transBoundaries.maxY;\r\n            }\r\n\r\n            if (transform.y <= transBoundaries.minY) {\r\n                origin.y = oBoundaries.maxY;\r\n                transform.y = transBoundaries.minY;\r\n            }\r\n        }\r\n        applyCss();\r\n        _debouncedOverlay.call(self);\r\n        _triggerUpdate.call(self);\r\n    }\r\n\r\n    function _getVirtualBoundaries(viewport) {\r\n        var self = this,\r\n            scale = self._currentZoom,\r\n            vpWidth = viewport.width,\r\n            vpHeight = viewport.height,\r\n            centerFromBoundaryX = self.elements.boundary.clientWidth / 2,\r\n            centerFromBoundaryY = self.elements.boundary.clientHeight / 2,\r\n            imgRect = self.elements.preview.getBoundingClientRect(),\r\n            curImgWidth = imgRect.width,\r\n            curImgHeight = imgRect.height,\r\n            halfWidth = vpWidth / 2,\r\n            halfHeight = vpHeight / 2;\r\n\r\n        var maxX = ((halfWidth / scale) - centerFromBoundaryX) * -1;\r\n        var minX = maxX - ((curImgWidth * (1 / scale)) - (vpWidth * (1 / scale)));\r\n\r\n        var maxY = ((halfHeight / scale) - centerFromBoundaryY) * -1;\r\n        var minY = maxY - ((curImgHeight * (1 / scale)) - (vpHeight * (1 / scale)));\r\n\r\n        var originMinX = (1 / scale) * halfWidth;\r\n        var originMaxX = (curImgWidth * (1 / scale)) - originMinX;\r\n\r\n        var originMinY = (1 / scale) * halfHeight;\r\n        var originMaxY = (curImgHeight * (1 / scale)) - originMinY;\r\n\r\n        return {\r\n            translate: {\r\n                maxX: maxX,\r\n                minX: minX,\r\n                maxY: maxY,\r\n                minY: minY\r\n            },\r\n            origin: {\r\n                maxX: originMaxX,\r\n                minX: originMinX,\r\n                maxY: originMaxY,\r\n                minY: originMinY\r\n            }\r\n        };\r\n    }\r\n\r\n    function _updateCenterPoint(rotate) {\r\n        var self = this,\r\n            scale = self._currentZoom,\r\n            data = self.elements.preview.getBoundingClientRect(),\r\n            vpData = self.elements.viewport.getBoundingClientRect(),\r\n            transform = Transform.parse(self.elements.preview.style[CSS_TRANSFORM]),\r\n            pc = new TransformOrigin(self.elements.preview),\r\n            top = (vpData.top - data.top) + (vpData.height / 2),\r\n            left = (vpData.left - data.left) + (vpData.width / 2),\r\n            center = {},\r\n            adj = {};\r\n\r\n        if (rotate) {\r\n            var cx = pc.x;\r\n            var cy = pc.y;\r\n            var tx = transform.x;\r\n            var ty = transform.y;\r\n\r\n            center.y = cx;\r\n            center.x = cy;\r\n            transform.y = tx;\r\n            transform.x = ty;\r\n        }\r\n        else {\r\n            center.y = top / scale;\r\n            center.x = left / scale;\r\n\r\n            adj.y = (center.y - pc.y) * (1 - scale);\r\n            adj.x = (center.x - pc.x) * (1 - scale);\r\n\r\n            transform.x -= adj.x;\r\n            transform.y -= adj.y;\r\n        }\r\n\r\n        var newCss = {};\r\n        newCss[CSS_TRANS_ORG] = center.x + 'px ' + center.y + 'px';\r\n        newCss[CSS_TRANSFORM] = transform.toString();\r\n        css(self.elements.preview, newCss);\r\n    }\r\n\r\n    function _initDraggable() {\r\n        var self = this,\r\n            isDragging = false,\r\n            originalX,\r\n            originalY,\r\n            originalDistance,\r\n            vpRect,\r\n            transform;\r\n\r\n        function assignTransformCoordinates(deltaX, deltaY) {\r\n            var imgRect = self.elements.preview.getBoundingClientRect(),\r\n                top = transform.y + deltaY,\r\n                left = transform.x + deltaX;\r\n\r\n            if (self.options.enforceBoundary) {\r\n                if (vpRect.top > imgRect.top + deltaY && vpRect.bottom < imgRect.bottom + deltaY) {\r\n                    transform.y = top;\r\n                }\r\n\r\n                if (vpRect.left > imgRect.left + deltaX && vpRect.right < imgRect.right + deltaX) {\r\n                    transform.x = left;\r\n                }\r\n            }\r\n            else {\r\n                transform.y = top;\r\n                transform.x = left;\r\n            }\r\n        }\r\n\r\n        function toggleGrabState(isDragging) {\r\n          self.elements.preview.setAttribute('aria-grabbed', isDragging);\r\n          self.elements.boundary.setAttribute('aria-dropeffect', isDragging? 'move': 'none');\r\n        }\r\n\r\n        function keyDown(ev) {\r\n            var LEFT_ARROW  = 37,\r\n                UP_ARROW    = 38,\r\n                RIGHT_ARROW = 39,\r\n                DOWN_ARROW  = 40;\r\n\r\n            if (ev.shiftKey && (ev.keyCode === UP_ARROW || ev.keyCode === DOWN_ARROW)) {\r\n                var zoom;\r\n                if (ev.keyCode === UP_ARROW) {\r\n                    zoom = parseFloat(self.elements.zoomer.value) + parseFloat(self.elements.zoomer.step)\r\n                }\r\n                else {\r\n                    zoom = parseFloat(self.elements.zoomer.value) - parseFloat(self.elements.zoomer.step)\r\n                }\r\n                self.setZoom(zoom);\r\n            }\r\n            else if (self.options.enableKeyMovement && (ev.keyCode >= 37 && ev.keyCode <= 40)) {\r\n                ev.preventDefault();\r\n                var movement = parseKeyDown(ev.keyCode);\r\n\r\n                transform = Transform.parse(self.elements.preview);\r\n                document.body.style[CSS_USERSELECT] = 'none';\r\n                vpRect = self.elements.viewport.getBoundingClientRect();\r\n                keyMove(movement);\r\n            }\r\n\r\n            function parseKeyDown(key) {\r\n                switch (key) {\r\n                    case LEFT_ARROW:\r\n                        return [1, 0];\r\n                    case UP_ARROW:\r\n                        return [0, 1];\r\n                    case RIGHT_ARROW:\r\n                        return [-1, 0];\r\n                    case DOWN_ARROW:\r\n                        return [0, -1];\r\n                }\r\n            }\r\n        }\r\n\r\n        function keyMove(movement) {\r\n            var deltaX = movement[0],\r\n                deltaY = movement[1],\r\n                newCss = {};\r\n\r\n            assignTransformCoordinates(deltaX, deltaY);\r\n\r\n            newCss[CSS_TRANSFORM] = transform.toString();\r\n            css(self.elements.preview, newCss);\r\n            _updateOverlay.call(self);\r\n            document.body.style[CSS_USERSELECT] = '';\r\n            _updateCenterPoint.call(self);\r\n            _triggerUpdate.call(self);\r\n            originalDistance = 0;\r\n        }\r\n\r\n        function mouseDown(ev) {\r\n            if (ev.button !== undefined && ev.button !== 0) return;\r\n\r\n            ev.preventDefault();\r\n            if (isDragging) return;\r\n            isDragging = true;\r\n            originalX = ev.pageX;\r\n            originalY = ev.pageY;\r\n\r\n            if (ev.touches) {\r\n                var touches = ev.touches[0];\r\n                originalX = touches.pageX;\r\n                originalY = touches.pageY;\r\n            }\r\n            toggleGrabState(isDragging);\r\n            transform = Transform.parse(self.elements.preview);\r\n            window.addEventListener('mousemove', mouseMove);\r\n            window.addEventListener('touchmove', mouseMove);\r\n            window.addEventListener('mouseup', mouseUp);\r\n            window.addEventListener('touchend', mouseUp);\r\n            document.body.style[CSS_USERSELECT] = 'none';\r\n            vpRect = self.elements.viewport.getBoundingClientRect();\r\n        }\r\n\r\n        function mouseMove(ev) {\r\n            ev.preventDefault();\r\n            var pageX = ev.pageX,\r\n                pageY = ev.pageY;\r\n\r\n            if (ev.touches) {\r\n                var touches = ev.touches[0];\r\n                pageX = touches.pageX;\r\n                pageY = touches.pageY;\r\n            }\r\n\r\n            var deltaX = pageX - originalX,\r\n                deltaY = pageY - originalY,\r\n                newCss = {};\r\n\r\n            if (ev.type === 'touchmove') {\r\n                if (ev.touches.length > 1) {\r\n                    var touch1 = ev.touches[0];\r\n                    var touch2 = ev.touches[1];\r\n                    var dist = Math.sqrt((touch1.pageX - touch2.pageX) * (touch1.pageX - touch2.pageX) + (touch1.pageY - touch2.pageY) * (touch1.pageY - touch2.pageY));\r\n\r\n                    if (!originalDistance) {\r\n                        originalDistance = dist / self._currentZoom;\r\n                    }\r\n\r\n                    var scale = dist / originalDistance;\r\n\r\n                    _setZoomerVal.call(self, scale);\r\n                    dispatchChange(self.elements.zoomer);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            assignTransformCoordinates(deltaX, deltaY);\r\n\r\n            newCss[CSS_TRANSFORM] = transform.toString();\r\n            css(self.elements.preview, newCss);\r\n            _updateOverlay.call(self);\r\n            originalY = pageY;\r\n            originalX = pageX;\r\n        }\r\n\r\n        function mouseUp() {\r\n            isDragging = false;\r\n            toggleGrabState(isDragging);\r\n            window.removeEventListener('mousemove', mouseMove);\r\n            window.removeEventListener('touchmove', mouseMove);\r\n            window.removeEventListener('mouseup', mouseUp);\r\n            window.removeEventListener('touchend', mouseUp);\r\n            document.body.style[CSS_USERSELECT] = '';\r\n            _updateCenterPoint.call(self);\r\n            _triggerUpdate.call(self);\r\n            originalDistance = 0;\r\n        }\r\n\r\n        self.elements.overlay.addEventListener('mousedown', mouseDown);\r\n        self.elements.viewport.addEventListener('keydown', keyDown);\r\n        self.elements.overlay.addEventListener('touchstart', mouseDown);\r\n    }\r\n\r\n    function _updateOverlay() {\r\n        if (!this.elements) return; // since this is debounced, it can be fired after destroy\r\n        var self = this,\r\n            boundRect = self.elements.boundary.getBoundingClientRect(),\r\n            imgData = self.elements.preview.getBoundingClientRect();\r\n\r\n        css(self.elements.overlay, {\r\n            width: imgData.width + 'px',\r\n            height: imgData.height + 'px',\r\n            top: (imgData.top - boundRect.top) + 'px',\r\n            left: (imgData.left - boundRect.left) + 'px'\r\n        });\r\n    }\r\n    var _debouncedOverlay = debounce(_updateOverlay, 500);\r\n\r\n    function _triggerUpdate() {\r\n        var self = this,\r\n            data = self.get();\r\n\r\n        if (!_isVisible.call(self)) {\r\n            return;\r\n        }\r\n\r\n        self.options.update.call(self, data);\r\n        if (self.$ && typeof Prototype === 'undefined') {\r\n            self.$(self.element).trigger('update.croppie', data);\r\n        }\r\n        else {\r\n            var ev;\r\n            if (window.CustomEvent) {\r\n                ev = new CustomEvent('update', { detail: data });\r\n            } else {\r\n                ev = document.createEvent('CustomEvent');\r\n                ev.initCustomEvent('update', true, true, data);\r\n            }\r\n\r\n            self.element.dispatchEvent(ev);\r\n        }\r\n    }\r\n\r\n    function _isVisible() {\r\n        return this.elements.preview.offsetHeight > 0 && this.elements.preview.offsetWidth > 0;\r\n    }\r\n\r\n    function _updatePropertiesFromImage() {\r\n        var self = this,\r\n            initialZoom = 1,\r\n            cssReset = {},\r\n            img = self.elements.preview,\r\n            imgData,\r\n            transformReset = new Transform(0, 0, initialZoom),\r\n            originReset = new TransformOrigin(),\r\n            isVisible = _isVisible.call(self);\r\n\r\n        if (!isVisible || self.data.bound) {// if the croppie isn't visible or it doesn't need binding\r\n            return;\r\n        }\r\n\r\n        self.data.bound = true;\r\n        cssReset[CSS_TRANSFORM] = transformReset.toString();\r\n        cssReset[CSS_TRANS_ORG] = originReset.toString();\r\n        cssReset['opacity'] = 1;\r\n        css(img, cssReset);\r\n\r\n        imgData = self.elements.preview.getBoundingClientRect();\r\n\r\n        self._originalImageWidth = imgData.width;\r\n        self._originalImageHeight = imgData.height;\r\n        self.data.orientation = _hasExif.call(self) ? getExifOrientation(self.elements.img) : self.data.orientation;\r\n\r\n        if (self.options.enableZoom) {\r\n            _updateZoomLimits.call(self, true);\r\n        }\r\n        else {\r\n            self._currentZoom = initialZoom;\r\n        }\r\n\r\n        transformReset.scale = self._currentZoom;\r\n        cssReset[CSS_TRANSFORM] = transformReset.toString();\r\n        css(img, cssReset);\r\n\r\n        if (self.data.points.length) {\r\n            _bindPoints.call(self, self.data.points);\r\n        }\r\n        else {\r\n            _centerImage.call(self);\r\n        }\r\n\r\n        _updateCenterPoint.call(self);\r\n        _updateOverlay.call(self);\r\n    }\r\n\r\n    function _updateZoomLimits (initial) {\r\n        var self = this,\r\n            minZoom = Math.max(self.options.minZoom, 0) || 0,\r\n            maxZoom = self.options.maxZoom || 1.5,\r\n            initialZoom,\r\n            defaultInitialZoom,\r\n            zoomer = self.elements.zoomer,\r\n            scale = parseFloat(zoomer.value),\r\n            boundaryData = self.elements.boundary.getBoundingClientRect(),\r\n            imgData = naturalImageDimensions(self.elements.img, self.data.orientation),\r\n            vpData = self.elements.viewport.getBoundingClientRect(),\r\n            minW,\r\n            minH;\r\n        if (self.options.enforceBoundary) {\r\n            minW = vpData.width / imgData.width;\r\n            minH = vpData.height / imgData.height;\r\n            minZoom = Math.max(minW, minH);\r\n        }\r\n\r\n        if (minZoom >= maxZoom) {\r\n            maxZoom = minZoom + 1;\r\n        }\r\n\r\n        zoomer.min = fix(minZoom, 4);\r\n        zoomer.max = fix(maxZoom, 4);\r\n\r\n        if (!initial && (scale < zoomer.min || scale > zoomer.max)) {\r\n            _setZoomerVal.call(self, scale < zoomer.min ? zoomer.min : zoomer.max);\r\n        }\r\n        else if (initial) {\r\n            defaultInitialZoom = Math.max((boundaryData.width / imgData.width), (boundaryData.height / imgData.height));\r\n            initialZoom = self.data.boundZoom !== null ? self.data.boundZoom : defaultInitialZoom;\r\n            _setZoomerVal.call(self, initialZoom);\r\n        }\r\n\r\n        dispatchChange(zoomer);\r\n    }\r\n\r\n    function _bindPoints(points) {\r\n        if (points.length !== 4) {\r\n            throw \"Croppie - Invalid number of points supplied: \" + points;\r\n        }\r\n        var self = this,\r\n            pointsWidth = points[2] - points[0],\r\n            // pointsHeight = points[3] - points[1],\r\n            vpData = self.elements.viewport.getBoundingClientRect(),\r\n            boundRect = self.elements.boundary.getBoundingClientRect(),\r\n            vpOffset = {\r\n                left: vpData.left - boundRect.left,\r\n                top: vpData.top - boundRect.top\r\n            },\r\n            scale = vpData.width / pointsWidth,\r\n            originTop = points[1],\r\n            originLeft = points[0],\r\n            transformTop = (-1 * points[1]) + vpOffset.top,\r\n            transformLeft = (-1 * points[0]) + vpOffset.left,\r\n            newCss = {};\r\n\r\n        newCss[CSS_TRANS_ORG] = originLeft + 'px ' + originTop + 'px';\r\n        newCss[CSS_TRANSFORM] = new Transform(transformLeft, transformTop, scale).toString();\r\n        css(self.elements.preview, newCss);\r\n\r\n        _setZoomerVal.call(self, scale);\r\n        self._currentZoom = scale;\r\n    }\r\n\r\n    function _centerImage() {\r\n        var self = this,\r\n            imgDim = self.elements.preview.getBoundingClientRect(),\r\n            vpDim = self.elements.viewport.getBoundingClientRect(),\r\n            boundDim = self.elements.boundary.getBoundingClientRect(),\r\n            vpLeft = vpDim.left - boundDim.left,\r\n            vpTop = vpDim.top - boundDim.top,\r\n            w = vpLeft - ((imgDim.width - vpDim.width) / 2),\r\n            h = vpTop - ((imgDim.height - vpDim.height) / 2),\r\n            transform = new Transform(w, h, self._currentZoom);\r\n\r\n        css(self.elements.preview, CSS_TRANSFORM, transform.toString());\r\n    }\r\n\r\n    function _transferImageToCanvas(customOrientation) {\r\n        var self = this,\r\n            canvas = self.elements.canvas,\r\n            img = self.elements.img,\r\n            ctx = canvas.getContext('2d');\r\n\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        canvas.width = img.width;\r\n        canvas.height = img.height;\r\n\r\n        var orientation = self.options.enableOrientation && customOrientation || getExifOrientation(img);\r\n        drawCanvas(canvas, img, orientation);\r\n    }\r\n\r\n    function _getCanvas(data) {\r\n        var self = this,\r\n            points = data.points,\r\n            left = num(points[0]),\r\n            top = num(points[1]),\r\n            right = num(points[2]),\r\n            bottom = num(points[3]),\r\n            width = right-left,\r\n            height = bottom-top,\r\n            circle = data.circle,\r\n            canvas = document.createElement('canvas'),\r\n            ctx = canvas.getContext('2d'),\r\n            startX = 0,\r\n            startY = 0,\r\n            canvasWidth = data.outputWidth || width,\r\n            canvasHeight = data.outputHeight || height;\r\n\r\n        canvas.width = canvasWidth;\r\n        canvas.height = canvasHeight;\r\n\r\n        if (data.backgroundColor) {\r\n            ctx.fillStyle = data.backgroundColor;\r\n            ctx.fillRect(0, 0, canvasWidth, canvasHeight);\r\n        }\r\n\r\n        // By default assume we're going to draw the entire\r\n        // source image onto the destination canvas.\r\n        var sx = left,\r\n            sy = top,\r\n            sWidth = width,\r\n            sHeight = height,\r\n            dx = 0,\r\n            dy = 0,\r\n            dWidth = canvasWidth,\r\n            dHeight = canvasHeight;\r\n\r\n        //\r\n        // Do not go outside of the original image's bounds along the x-axis.\r\n        // Handle translations when projecting onto the destination canvas.\r\n        //\r\n\r\n        // The smallest possible source x-position is 0.\r\n        if (left < 0) {\r\n            sx = 0;\r\n            dx = (Math.abs(left) / width) * canvasWidth;\r\n        }\r\n\r\n        // The largest possible source width is the original image's width.\r\n        if (sWidth + sx > self._originalImageWidth) {\r\n            sWidth = self._originalImageWidth - sx;\r\n            dWidth =  (sWidth / width) * canvasWidth;\r\n        }\r\n\r\n        //\r\n        // Do not go outside of the original image's bounds along the y-axis.\r\n        //\r\n\r\n        // The smallest possible source y-position is 0.\r\n        if (top < 0) {\r\n            sy = 0;\r\n            dy = (Math.abs(top) / height) * canvasHeight;\r\n        }\r\n\r\n        // The largest possible source height is the original image's height.\r\n        if (sHeight + sy > self._originalImageHeight) {\r\n            sHeight = self._originalImageHeight - sy;\r\n            dHeight = (sHeight / height) * canvasHeight;\r\n        }\r\n\r\n        // console.table({ left, right, top, bottom, canvasWidth, canvasHeight, width, height, startX, startY, circle, sx, sy, dx, dy, sWidth, sHeight, dWidth, dHeight });\r\n\r\n        ctx.drawImage(this.elements.preview, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);\r\n        if (circle) {\r\n            ctx.fillStyle = '#fff';\r\n            ctx.globalCompositeOperation = 'destination-in';\r\n            ctx.beginPath();\r\n            ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, 0, Math.PI * 2, true);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n        return canvas;\r\n    }\r\n\r\n    function _getHtmlResult(data) {\r\n        var points = data.points,\r\n            div = document.createElement('div'),\r\n            img = document.createElement('img'),\r\n            width = points[2] - points[0],\r\n            height = points[3] - points[1];\r\n\r\n        addClass(div, 'croppie-result');\r\n        div.appendChild(img);\r\n        css(img, {\r\n            left: (-1 * points[0]) + 'px',\r\n            top: (-1 * points[1]) + 'px'\r\n        });\r\n        img.src = data.url;\r\n        css(div, {\r\n            width: width + 'px',\r\n            height: height + 'px'\r\n        });\r\n\r\n        return div;\r\n    }\r\n\r\n    function _getBase64Result(data) {\r\n        return _getCanvas.call(this, data).toDataURL(data.format, data.quality);\r\n    }\r\n\r\n    function _getBlobResult(data) {\r\n        var self = this;\r\n        return new Promise(function (resolve) {\r\n            _getCanvas.call(self, data).toBlob(function (blob) {\r\n                resolve(blob);\r\n            }, data.format, data.quality);\r\n        });\r\n    }\r\n\r\n    function _replaceImage(img) {\r\n        if (this.elements.img.parentNode) {\r\n            Array.prototype.forEach.call(this.elements.img.classList, function(c) { img.classList.add(c); });\r\n            this.elements.img.parentNode.replaceChild(img, this.elements.img);\r\n            this.elements.preview = img; // if the img is attached to the DOM, they're not using the canvas\r\n        }\r\n        this.elements.img = img;\r\n    }\r\n\r\n    function _bind(options, cb) {\r\n        var self = this,\r\n            url,\r\n            points = [],\r\n            zoom = null,\r\n            hasExif = _hasExif.call(self);\r\n\r\n        if (typeof (options) === 'string') {\r\n            url = options;\r\n            options = {};\r\n        }\r\n        else if (Array.isArray(options)) {\r\n            points = options.slice();\r\n        }\r\n        else if (typeof (options) === 'undefined' && self.data.url) { //refreshing\r\n            _updatePropertiesFromImage.call(self);\r\n            _triggerUpdate.call(self);\r\n            return null;\r\n        }\r\n        else {\r\n            url = options.url;\r\n            points = options.points || [];\r\n            zoom = typeof(options.zoom) === 'undefined' ? null : options.zoom;\r\n        }\r\n\r\n        self.data.bound = false;\r\n        self.data.url = url || self.data.url;\r\n        self.data.boundZoom = zoom;\r\n\r\n        return loadImage(url, hasExif).then(function (img) {\r\n            _replaceImage.call(self, img);\r\n            if (!points.length) {\r\n                var natDim = naturalImageDimensions(img);\r\n                var rect = self.elements.viewport.getBoundingClientRect();\r\n                var aspectRatio = rect.width / rect.height;\r\n                var imgAspectRatio = natDim.width / natDim.height;\r\n                var width, height;\r\n\r\n                if (imgAspectRatio > aspectRatio) {\r\n                    height = natDim.height;\r\n                    width = height * aspectRatio;\r\n                }\r\n                else {\r\n                    width = natDim.width;\r\n                    height = natDim.height / aspectRatio;\r\n                }\r\n\r\n                var x0 = (natDim.width - width) / 2;\r\n                var y0 = (natDim.height - height) / 2;\r\n                var x1 = x0 + width;\r\n                var y1 = y0 + height;\r\n                self.data.points = [x0, y0, x1, y1];\r\n            }\r\n            else if (self.options.relative) {\r\n                points = [\r\n                    points[0] * img.naturalWidth / 100,\r\n                    points[1] * img.naturalHeight / 100,\r\n                    points[2] * img.naturalWidth / 100,\r\n                    points[3] * img.naturalHeight / 100\r\n                ];\r\n            }\r\n\r\n            self.data.orientation = options.orientation || 1;\r\n            self.data.points = points.map(function (p) {\r\n                return parseFloat(p);\r\n            });\r\n            if (self.options.useCanvas) {\r\n                _transferImageToCanvas.call(self, self.data.orientation);\r\n            }\r\n            _updatePropertiesFromImage.call(self);\r\n            _triggerUpdate.call(self);\r\n            cb && cb();\r\n        });\r\n    }\r\n\r\n    function fix(v, decimalPoints) {\r\n        return parseFloat(v).toFixed(decimalPoints || 0);\r\n    }\r\n\r\n    function _get() {\r\n        var self = this,\r\n            imgData = self.elements.preview.getBoundingClientRect(),\r\n            vpData = self.elements.viewport.getBoundingClientRect(),\r\n            x1 = vpData.left - imgData.left,\r\n            y1 = vpData.top - imgData.top,\r\n            widthDiff = (vpData.width - self.elements.viewport.offsetWidth) / 2, //border\r\n            heightDiff = (vpData.height - self.elements.viewport.offsetHeight) / 2,\r\n            x2 = x1 + self.elements.viewport.offsetWidth + widthDiff,\r\n            y2 = y1 + self.elements.viewport.offsetHeight + heightDiff,\r\n            scale = self._currentZoom;\r\n\r\n        if (scale === Infinity || isNaN(scale)) {\r\n            scale = 1;\r\n        }\r\n\r\n        var max = self.options.enforceBoundary ? 0 : Number.NEGATIVE_INFINITY;\r\n        x1 = Math.max(max, x1 / scale);\r\n        y1 = Math.max(max, y1 / scale);\r\n        x2 = Math.max(max, x2 / scale);\r\n        y2 = Math.max(max, y2 / scale);\r\n\r\n        return {\r\n            points: [fix(x1), fix(y1), fix(x2), fix(y2)],\r\n            zoom: scale,\r\n            orientation: self.data.orientation\r\n        };\r\n    }\r\n\r\n    var RESULT_DEFAULTS = {\r\n            type: 'canvas',\r\n            format: 'png',\r\n            quality: 1\r\n        },\r\n        RESULT_FORMATS = ['jpeg', 'webp', 'png'];\r\n\r\n    function _result(options) {\r\n        var self = this,\r\n            data = _get.call(self),\r\n            opts = deepExtend(clone(RESULT_DEFAULTS), clone(options)),\r\n            resultType = (typeof (options) === 'string' ? options : (opts.type || 'base64')),\r\n            size = opts.size || 'viewport',\r\n            format = opts.format,\r\n            quality = opts.quality,\r\n            backgroundColor = opts.backgroundColor,\r\n            circle = typeof opts.circle === 'boolean' ? opts.circle : (self.options.viewport.type === 'circle'),\r\n            vpRect = self.elements.viewport.getBoundingClientRect(),\r\n            ratio = vpRect.width / vpRect.height,\r\n            prom;\r\n\r\n        if (size === 'viewport') {\r\n            data.outputWidth = vpRect.width;\r\n            data.outputHeight = vpRect.height;\r\n        } else if (typeof size === 'object') {\r\n            if (size.width && size.height) {\r\n                data.outputWidth = size.width;\r\n                data.outputHeight = size.height;\r\n            } else if (size.width) {\r\n                data.outputWidth = size.width;\r\n                data.outputHeight = size.width / ratio;\r\n            } else if (size.height) {\r\n                data.outputWidth = size.height * ratio;\r\n                data.outputHeight = size.height;\r\n            }\r\n        }\r\n\r\n        if (RESULT_FORMATS.indexOf(format) > -1) {\r\n            data.format = 'image/' + format;\r\n            data.quality = quality;\r\n        }\r\n\r\n        data.circle = circle;\r\n        data.url = self.data.url;\r\n        data.backgroundColor = backgroundColor;\r\n\r\n        prom = new Promise(function (resolve) {\r\n            switch(resultType.toLowerCase())\r\n            {\r\n                case 'rawcanvas':\r\n                    resolve(_getCanvas.call(self, data));\r\n                    break;\r\n                case 'canvas':\r\n                case 'base64':\r\n                    resolve(_getBase64Result.call(self, data));\r\n                    break;\r\n                case 'blob':\r\n                    _getBlobResult.call(self, data).then(resolve);\r\n                    break;\r\n                default:\r\n                    resolve(_getHtmlResult.call(self, data));\r\n                    break;\r\n            }\r\n        });\r\n        return prom;\r\n    }\r\n\r\n    function _refresh() {\r\n        _updatePropertiesFromImage.call(this);\r\n    }\r\n\r\n    function _rotate(deg) {\r\n        if (!this.options.useCanvas || !this.options.enableOrientation) {\r\n            throw 'Croppie: Cannot rotate without enableOrientation && EXIF.js included';\r\n        }\r\n\r\n        var self = this,\r\n            canvas = self.elements.canvas;\r\n\r\n        self.data.orientation = getExifOffset(self.data.orientation, deg);\r\n        drawCanvas(canvas, self.elements.img, self.data.orientation);\r\n        _updateCenterPoint.call(self, true);\r\n        _updateZoomLimits.call(self);\r\n\r\n        // Reverses image dimensions if the degrees of rotation is not divisible by 180.\r\n        if ((Math.abs(deg) / 90) % 2 === 1) {\r\n            var oldHeight = self._originalImageHeight;\r\n            var oldWidth = self._originalImageWidth;\r\n            self._originalImageWidth = oldHeight;\r\n            self._originalImageHeight = oldWidth;\r\n        }\r\n    }\r\n\r\n    function _destroy() {\r\n        var self = this;\r\n        self.element.removeChild(self.elements.boundary);\r\n        removeClass(self.element, 'croppie-container');\r\n        if (self.options.enableZoom) {\r\n            self.element.removeChild(self.elements.zoomerWrap);\r\n        }\r\n        delete self.elements;\r\n    }\r\n\r\n    if (typeof window !== 'undefined' && window.jQuery) {\r\n        var $ = window.jQuery;\r\n        $.fn.croppie = function (opts) {\r\n            var ot = typeof opts;\r\n\r\n            if (ot === 'string') {\r\n                var args = Array.prototype.slice.call(arguments, 1);\r\n                var singleInst = $(this).data('croppie');\r\n\r\n                if (opts === 'get') {\r\n                    return singleInst.get();\r\n                }\r\n                else if (opts === 'result') {\r\n                    return singleInst.result.apply(singleInst, args);\r\n                }\r\n                else if (opts === 'bind') {\r\n                    return singleInst.bind.apply(singleInst, args);\r\n                }\r\n\r\n                return this.each(function () {\r\n                    var i = $(this).data('croppie');\r\n                    if (!i) return;\r\n\r\n                    var method = i[opts];\r\n                    if ($.isFunction(method)) {\r\n                        method.apply(i, args);\r\n                        if (opts === 'destroy') {\r\n                            $(this).removeData('croppie');\r\n                        }\r\n                    }\r\n                    else {\r\n                        throw 'Croppie ' + opts + ' method not found';\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                return this.each(function () {\r\n                    var i = new Croppie(this, opts);\r\n                    i.$ = $;\r\n                    $(this).data('croppie', i);\r\n                });\r\n            }\r\n        };\r\n    }\r\n\r\n    function Croppie(element, opts) {\r\n        if (element.className.indexOf('croppie-container') > -1) {\r\n            throw new Error(\"Croppie: Can't initialize croppie more than once\");\r\n        }\r\n        this.element = element;\r\n        this.options = deepExtend(clone(Croppie.defaults), opts);\r\n\r\n        if (this.element.tagName.toLowerCase() === 'img') {\r\n            var origImage = this.element;\r\n            addClass(origImage, 'cr-original-image');\r\n            setAttributes(origImage, {'aria-hidden' : 'true', 'alt' : '' });\r\n            var replacementDiv = document.createElement('div');\r\n            this.element.parentNode.appendChild(replacementDiv);\r\n            replacementDiv.appendChild(origImage);\r\n            this.element = replacementDiv;\r\n            this.options.url = this.options.url || origImage.src;\r\n        }\r\n\r\n        _create.call(this);\r\n        if (this.options.url) {\r\n            var bindOpts = {\r\n                url: this.options.url,\r\n                points: this.options.points\r\n            };\r\n            delete this.options['url'];\r\n            delete this.options['points'];\r\n            _bind.call(this, bindOpts);\r\n        }\r\n    }\r\n\r\n    Croppie.defaults = {\r\n        viewport: {\r\n            width: 100,\r\n            height: 100,\r\n            type: 'square'\r\n        },\r\n        boundary: { },\r\n        orientationControls: {\r\n            enabled: true,\r\n            leftClass: '',\r\n            rightClass: ''\r\n        },\r\n        resizeControls: {\r\n            width: true,\r\n            height: true\r\n        },\r\n        customClass: '',\r\n        showZoomer: true,\r\n        enableZoom: true,\r\n        enableResize: false,\r\n        mouseWheelZoom: true,\r\n        enableExif: false,\r\n        enforceBoundary: true,\r\n        enableOrientation: false,\r\n        enableKeyMovement: true,\r\n        update: function () { }\r\n    };\r\n\r\n    Croppie.globals = {\r\n        translate: 'translate3d'\r\n    };\r\n\r\n    deepExtend(Croppie.prototype, {\r\n        bind: function (options, cb) {\r\n            return _bind.call(this, options, cb);\r\n        },\r\n        get: function () {\r\n            var data = _get.call(this);\r\n            var points = data.points;\r\n            if (this.options.relative) {\r\n                points[0] /= this.elements.img.naturalWidth / 100;\r\n                points[1] /= this.elements.img.naturalHeight / 100;\r\n                points[2] /= this.elements.img.naturalWidth / 100;\r\n                points[3] /= this.elements.img.naturalHeight / 100;\r\n            }\r\n            return data;\r\n        },\r\n        result: function (type) {\r\n            return _result.call(this, type);\r\n        },\r\n        refresh: function () {\r\n            return _refresh.call(this);\r\n        },\r\n        setZoom: function (v) {\r\n            _setZoomerVal.call(this, v);\r\n            dispatchChange(this.elements.zoomer);\r\n        },\r\n        rotate: function (deg) {\r\n            _rotate.call(this, deg);\r\n        },\r\n        destroy: function () {\r\n            return _destroy.call(this);\r\n        }\r\n    });\r\n    return Croppie;\r\n}));\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}